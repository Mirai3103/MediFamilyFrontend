import{r as j,o as f,v as N,R as u,j as e,q as v,s as y,L as b,b as h,w,x as k,y as C}from"./index-BW1v2Y3o.js";import{B as p}from"./index-lZj-UG3P.js";import{C as L,b as S,c as M,d as q,e as B}from"./card-Bb8dNGOw.js";import{I as A}from"./input-B9pFp4AM.js";import{S as T}from"./separator-DARbAqyQ.js";import{z as m}from"./index-B3p3PcZP.js";import{S as E}from"./search-CqHQ4pyN.js";import{L as F}from"./loader-circle-hO0Wh3rx.js";import{u as G}from"./shareStore-CvkHOfcA.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-BIXz2lW7.js";m.object({familyName:m.string().min(3,{message:"Tên gia đình phải có ít nhất 3 ký tự."}).max(255,{message:"Tên gia đình không được vượt quá 255 ký tự."}),address:m.string().max(500,{message:"Địa chỉ không được vượt quá 500 ký tự."}),phoneNumber:m.string().regex(/^(\+84|0)[3|5|7|8|9][0-9]{8}$/,{message:"Số điện thoại không hợp lệ. Vui lòng nhập số điện thoại Việt Nam hợp lệ."}),email:m.string().email({message:"Email không hợp lệ."}).max(100,{message:"Email không được vượt quá 100 ký tự."})});const I=({allowFamilyIds:i})=>{console.log({allowFamilyIds:i});const[l,o]=j.useState(""),r=f(),{data:a,isLoading:n,isError:d}=N({ids:i},{query:{enabled:!!i&&i.length>0}}),t=u.useMemo(()=>a?(console.log(a),a==null?void 0:a.filter(s=>{var c;return(c=s.familyName)==null?void 0:c.toLowerCase().includes(l.toLowerCase())})):[],[a,l]);return e.jsx("div",{className:"flex flex-col min-h-screen",children:e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"container py-6",children:e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gia đình được chia sẻ"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Xem và quản lý các gia đình mà bạn được chia sẻ"})]})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(E,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(A,{placeholder:"Tìm kiếm gia đình...",className:"pl-8 bg-white",value:l,onChange:s=>o(s.target.value)})]})}),n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(F,{className:"h-12 w-12 animate-spin text-health-blue mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Đang tải dữ liệu gia đình..."})]}):d?e.jsxs("div",{className:"flex flex-col items-center justify-center bg-red-50 p-6 rounded-lg",children:[e.jsx("p",{className:"text-red-600 font-medium",children:"Đã xảy ra lỗi khi tải dữ liệu"}),e.jsx(p,{variant:"outline",className:"mt-4",onClick:()=>r.invalidateQueries({queryKey:v()}),children:"Thử lại"})]}):t.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center bg-gray-50 p-10 rounded-lg",children:l?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Không tìm thấy gia đình nào phù hợp"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Hãy thử tìm kiếm với từ khóa khác"})]}):e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-gray-600 mb-2",children:"Bạn chưa có gia đình nào được chia sẻ"})})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:t.map(s=>{var c,x,g;return e.jsxs(L,{className:"bg-white border border-gray-200 py-2 gap-y-2 rounded-lg shadow-sm hover:shadow-md transition-all overflow-hidden",children:[e.jsxs("div",{className:"bg-health-blue/10 px-6 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(S,{className:"text-xl text-health-blue font-semibold truncate",children:s.familyName}),e.jsx("div",{className:"bg-green-100 text-green-700 text-xs font-medium px-2.5 py-1 rounded-full",children:"Active"})]}),e.jsxs(M,{className:"mt-1 text-sm text-gray-500",children:["Cập nhật:"," ",y(s.updatedAt||s.createdAt).format("DD/MM/YYYY")]})]}),e.jsxs(q,{className:"",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-health-blue/20 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-health-blue font-bold",children:((x=(c=s.owner)==null?void 0:c.fullName)==null?void 0:x.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Chủ hộ"}),e.jsx("div",{className:"text-sm text-gray-700",children:((g=s.owner)==null?void 0:g.fullName)||"Chưa có thông tin"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-md p-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Thành viên"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:5}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"người"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Lịch hẹn"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 mr-1.5"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Đang hoạt động"})]})]})]}),e.jsx(T,{className:"my-3"}),e.jsxs("div",{className:"space-y-2.5",children:[s.address&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 mt-0.5 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),e.jsx("span",{className:"text-sm text-gray-600 leading-tight",children:s.address})]}),s.phoneNumber&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"text-sm text-gray-600",children:s.phoneNumber})]}),s.email&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:s.email})]})]})]}),e.jsx(B,{className:"px-5 py-1  border-t border-gray-100",children:e.jsx(p,{variant:"default",className:"w-full  text-white",asChild:!0,children:e.jsx(b,{to:"/home/families/"+s.id,children:e.jsxs("span",{className:"flex items-center justify-center",children:["Xem chi tiết",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})})})]},s.id)})})]})})})})},U=function(){const l=G()||[],o=h(s=>s.mergeAbility),r=h(s=>s.profile),a=h(s=>s.profile),{data:n=[],isFetched:d}=w({query:{enabled:!!(r!=null&&r.id)}}),{data:t}=k({ids:[...l,...n==null?void 0:n.map(s=>s.id)]},{query:{enabled:d}});return u.useEffect(()=>{t&&a&&(console.log("Ability merge"),o(C(t,a)))},[t,a]),console.log("total allow family",t==null?void 0:t.map(s=>s.familyId),t,d,!!(r!=null&&r.id),r),e.jsx(I,{allowFamilyIds:(t==null?void 0:t.map(s=>s.familyId))||[]})};export{U as component};
