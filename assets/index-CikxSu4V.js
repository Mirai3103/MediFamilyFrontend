import{r as l,j as e,o as Br,z as Ee,A as Ur,s as pe,t as W,B as zr,e as Kr,d as Yr,k as ye,C as Xr,u as ur,D as Wr,E as Qr,F as he,G as xe,H as Jr,b as St,m as Zr}from"./index-BW1v2Y3o.js";import{m as mr,f as en,p as tn,q as rn,r as nn,e as sn,s as an,t as ln,u as Ze,v as on,l as cn,w as dn,x as un,F as mn,y as hn,a as xn,z as et}from"./index-Bvgfl4DN.js";import{u as hr,P as Z,a as pn,c as ee,B as P,b as fe}from"./index-lZj-UG3P.js";import{D as tt,b as jt,c as bt,d as yt,e as Nt,f as Ce,a as fn}from"./dialog-CtifNpLo.js";import{I as H}from"./input-B9pFp4AM.js";import{u as we,s as Te,C as gn,L as Ne}from"./label-C5VtnZRZ.js";import{T as xr,a as pr,b as Se,c as ke}from"./tabs-Bg8Hq9Zq.js";import{C as fr,a as gr,d as vr,e as vn,b as jn,c as bn}from"./card-Bb8dNGOw.js";import{D as yn,a as Nn,b as Cn,c as kt,d as wn}from"./dropdown-menu-B6SE2GuO.js";import{A as rt,a as nt,b as st,c as at,d as it,e as lt,f as ot,g as ct}from"./alert-dialog-C4OSfZMw.js";import{B as jr}from"./badge-B4P0SrPl.js";import{c as Tn,u as Sn,a as se,P as br}from"./index-BvPlwEJa.js";import{P as kn,D as En,R as Dn,a as In,O as Rn,C as An}from"./index-fdDP8kav.js";import{u as re}from"./index-BYx5ngvf.js";import{c as yr,R as Fn,A as Pn,a as qn,C as On}from"./index-BWVphily.js";import{R as Mn,S as Et,a as Dt,b as It,c as Rt,d as Pe}from"./select-D2Gb7fMh.js";import{c as _n,d as Ln,e as Hn,A as dt,a as ut,b as mt}from"./avatar-CiTwwk9L.js";import{g as Nr}from"./file-D5Y2yJfI.js";import{S as $n}from"./separator-DARbAqyQ.js";import{o as De,s as Q,n as Gn,b as Cr,a as Vn,l as At,c as Bn}from"./index-B3p3PcZP.js";import{F as ht,a as V,b as B,c as U,d as z,e as X}from"./form-CBmUezT4.js";import{c as Un,d as zn,b as Kn}from"./doctor-family-controller-DpQcl4lR.js";import{S as Yn,b as Xn,c as Wn,d as Qn,e as Jn,f as Zn}from"./sheet-BqcafAUO.js";import{T as es}from"./textarea-DMIEle1g.js";import{P as Ft,a as Pt,b as qt}from"./popover-DmVzagL2.js";import{S as Ot}from"./switch-YhyiwIE6.js";import{c as ts}from"./createLucideIcon-BIXz2lW7.js";import{C as Mt}from"./check-BMh_iTMB.js";import{S as rs}from"./index-CT7QtIGo.js";import"./clsx-B-dksMZM.js";import"./index-CqIhzmhs.js";import"./index-DcUGr25C.js";import"./index-Bb3g6j3I.js";import"./en-US-5imNvEBo.js";import"./endOfMonth-DGAv_To5.js";import"./format-CR5l4UVX.js";import"./chevron-right-66CTOTse.js";import"./drawer-CY_oHpP7.js";import"./checkbox-Do6_XIjt.js";const _t={ACCEPTED:"ACCEPTED"},xt={FEMALE:"FEMALE",MALE:"MALE"};/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Lt=ts("ChevronsUpDown",ns);var[Ie,di]=Tn("Tooltip",[yr]),Re=yr(),wr="TooltipProvider",ss=700,pt="tooltip.open",[as,Ct]=Ie(wr),Tr=t=>{const{__scopeTooltip:n,delayDuration:r=ss,skipDelayDuration:s=300,disableHoverableContent:a=!1,children:c}=t,o=l.useRef(!0),x=l.useRef(!1),d=l.useRef(0);return l.useEffect(()=>{const i=d.current;return()=>window.clearTimeout(i)},[]),e.jsx(as,{scope:n,isOpenDelayedRef:o,delayDuration:r,onOpen:l.useCallback(()=>{window.clearTimeout(d.current),o.current=!1},[]),onClose:l.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>o.current=!0,s)},[s]),isPointerInTransitRef:x,onPointerInTransitChange:l.useCallback(i=>{x.current=i},[]),disableHoverableContent:a,children:c})};Tr.displayName=wr;var ge="Tooltip",[is,ve]=Ie(ge),Sr=t=>{const{__scopeTooltip:n,children:r,open:s,defaultOpen:a,onOpenChange:c,disableHoverableContent:o,delayDuration:x}=t,d=Ct(ge,t.__scopeTooltip),i=Re(n),[h,p]=l.useState(null),g=re(),u=l.useRef(0),v=o??d.disableHoverableContent,k=x??d.delayDuration,b=l.useRef(!1),[R,E]=Sn({prop:s,defaultProp:a??!1,onChange:D=>{D?(d.onOpen(),document.dispatchEvent(new CustomEvent(pt))):d.onClose(),c==null||c(D)},caller:ge}),q=l.useMemo(()=>R?b.current?"delayed-open":"instant-open":"closed",[R]),F=l.useCallback(()=>{window.clearTimeout(u.current),u.current=0,b.current=!1,E(!0)},[E]),A=l.useCallback(()=>{window.clearTimeout(u.current),u.current=0,E(!1)},[E]),T=l.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>{b.current=!0,E(!0),u.current=0},k)},[k,E]);return l.useEffect(()=>()=>{u.current&&(window.clearTimeout(u.current),u.current=0)},[]),e.jsx(Fn,{...i,children:e.jsx(is,{scope:n,contentId:g,open:R,stateAttribute:q,trigger:h,onTriggerChange:p,onTriggerEnter:l.useCallback(()=>{d.isOpenDelayedRef.current?T():F()},[d.isOpenDelayedRef,T,F]),onTriggerLeave:l.useCallback(()=>{v?A():(window.clearTimeout(u.current),u.current=0)},[A,v]),onOpen:F,onClose:A,disableHoverableContent:v,children:r})})};Sr.displayName=ge;var ft="TooltipTrigger",kr=l.forwardRef((t,n)=>{const{__scopeTooltip:r,...s}=t,a=ve(ft,r),c=Ct(ft,r),o=Re(r),x=l.useRef(null),d=hr(n,x,a.onTriggerChange),i=l.useRef(!1),h=l.useRef(!1),p=l.useCallback(()=>i.current=!1,[]);return l.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(Pn,{asChild:!0,...o,children:e.jsx(Z.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...s,ref:d,onPointerMove:se(t.onPointerMove,g=>{g.pointerType!=="touch"&&!h.current&&!c.isPointerInTransitRef.current&&(a.onTriggerEnter(),h.current=!0)}),onPointerLeave:se(t.onPointerLeave,()=>{a.onTriggerLeave(),h.current=!1}),onPointerDown:se(t.onPointerDown,()=>{a.open&&a.onClose(),i.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:se(t.onFocus,()=>{i.current||a.onOpen()}),onBlur:se(t.onBlur,a.onClose),onClick:se(t.onClick,a.onClose)})})});kr.displayName=ft;var wt="TooltipPortal",[ls,os]=Ie(wt,{forceMount:void 0}),Er=t=>{const{__scopeTooltip:n,forceMount:r,children:s,container:a}=t,c=ve(wt,n);return e.jsx(ls,{scope:n,forceMount:r,children:e.jsx(br,{present:r||c.open,children:e.jsx(kn,{asChild:!0,container:a,children:s})})})};Er.displayName=wt;var le="TooltipContent",Dr=l.forwardRef((t,n)=>{const r=os(le,t.__scopeTooltip),{forceMount:s=r.forceMount,side:a="top",...c}=t,o=ve(le,t.__scopeTooltip);return e.jsx(br,{present:s||o.open,children:o.disableHoverableContent?e.jsx(Ir,{side:a,...c,ref:n}):e.jsx(cs,{side:a,...c,ref:n})})}),cs=l.forwardRef((t,n)=>{const r=ve(le,t.__scopeTooltip),s=Ct(le,t.__scopeTooltip),a=l.useRef(null),c=hr(n,a),[o,x]=l.useState(null),{trigger:d,onClose:i}=r,h=a.current,{onPointerInTransitChange:p}=s,g=l.useCallback(()=>{x(null),p(!1)},[p]),u=l.useCallback((v,k)=>{const b=v.currentTarget,R={x:v.clientX,y:v.clientY},E=hs(R,b.getBoundingClientRect()),q=xs(R,E),F=ps(k.getBoundingClientRect()),A=gs([...q,...F]);x(A),p(!0)},[p]);return l.useEffect(()=>()=>g(),[g]),l.useEffect(()=>{if(d&&h){const v=b=>u(b,h),k=b=>u(b,d);return d.addEventListener("pointerleave",v),h.addEventListener("pointerleave",k),()=>{d.removeEventListener("pointerleave",v),h.removeEventListener("pointerleave",k)}}},[d,h,u,g]),l.useEffect(()=>{if(o){const v=k=>{const b=k.target,R={x:k.clientX,y:k.clientY},E=(d==null?void 0:d.contains(b))||(h==null?void 0:h.contains(b)),q=!fs(R,o);E?g():q&&(g(),i())};return document.addEventListener("pointermove",v),()=>document.removeEventListener("pointermove",v)}},[d,h,o,i,g]),e.jsx(Ir,{...t,ref:c})}),[ds,us]=Ie(ge,{isInside:!1}),ms=pn("TooltipContent"),Ir=l.forwardRef((t,n)=>{const{__scopeTooltip:r,children:s,"aria-label":a,onEscapeKeyDown:c,onPointerDownOutside:o,...x}=t,d=ve(le,r),i=Re(r),{onClose:h}=d;return l.useEffect(()=>(document.addEventListener(pt,h),()=>document.removeEventListener(pt,h)),[h]),l.useEffect(()=>{if(d.trigger){const p=g=>{const u=g.target;u!=null&&u.contains(d.trigger)&&h()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[d.trigger,h]),e.jsx(En,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:c,onPointerDownOutside:o,onFocusOutside:p=>p.preventDefault(),onDismiss:h,children:e.jsxs(On,{"data-state":d.stateAttribute,...i,...x,ref:n,style:{...x.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(ms,{children:s}),e.jsx(ds,{scope:r,isInside:!0,children:e.jsx(Mn,{id:d.contentId,role:"tooltip",children:a||s})})]})})});Dr.displayName=le;var Rr="TooltipArrow",Ar=l.forwardRef((t,n)=>{const{__scopeTooltip:r,...s}=t,a=Re(r);return us(Rr,r).isInside?null:e.jsx(qn,{...a,...s,ref:n})});Ar.displayName=Rr;function hs(t,n){const r=Math.abs(n.top-t.y),s=Math.abs(n.bottom-t.y),a=Math.abs(n.right-t.x),c=Math.abs(n.left-t.x);switch(Math.min(r,s,a,c)){case c:return"left";case a:return"right";case r:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function xs(t,n,r=5){const s=[];switch(n){case"top":s.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":s.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":s.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":s.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return s}function ps(t){const{top:n,right:r,bottom:s,left:a}=t;return[{x:a,y:n},{x:r,y:n},{x:r,y:s},{x:a,y:s}]}function fs(t,n){const{x:r,y:s}=t;let a=!1;for(let c=0,o=n.length-1;c<n.length;o=c++){const x=n[c],d=n[o],i=x.x,h=x.y,p=d.x,g=d.y;h>s!=g>s&&r<(p-i)*(s-h)/(g-h)+i&&(a=!a)}return a}function gs(t){const n=t.slice();return n.sort((r,s)=>r.x<s.x?-1:r.x>s.x?1:r.y<s.y?-1:r.y>s.y?1:0),vs(n)}function vs(t){if(t.length<=1)return t.slice();const n=[];for(let s=0;s<t.length;s++){const a=t[s];for(;n.length>=2;){const c=n[n.length-1],o=n[n.length-2];if((c.x-o.x)*(a.y-o.y)>=(c.y-o.y)*(a.x-o.x))n.pop();else break}n.push(a)}n.pop();const r=[];for(let s=t.length-1;s>=0;s--){const a=t[s];for(;r.length>=2;){const c=r[r.length-1],o=r[r.length-2];if((c.x-o.x)*(a.y-o.y)>=(c.y-o.y)*(a.x-o.x))r.pop();else break}r.push(a)}return r.pop(),n.length===1&&r.length===1&&n[0].x===r[0].x&&n[0].y===r[0].y?n:n.concat(r)}var js=Tr,bs=Sr,ys=kr,Ns=Er,Cs=Dr,ws=Ar;function Ts({delayDuration:t=0,...n}){return e.jsx(js,{"data-slot":"tooltip-provider",delayDuration:t,...n})}function Ht({...t}){return e.jsx(Ts,{children:e.jsx(bs,{"data-slot":"tooltip",...t})})}function $t({...t}){return e.jsx(ys,{"data-slot":"tooltip-trigger",...t})}function Gt({className:t,sideOffset:n=0,children:r,...s}){return e.jsx(Ns,{children:e.jsxs(Cs,{"data-slot":"tooltip-content",sideOffset:n,className:ee("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit rounded-md px-3 py-1.5 text-xs text-balance",t),...s,children:[r,e.jsx(ws,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}const Ss=({member:t,isHouseholder:n,isCurrentUserHouseholder:r,onViewMedicalProfile:s,onEditMember:a})=>{var A,T,D,O,K,_,$,M;const[c,o]=l.useState(!1),x=ks((A=t.profile)==null?void 0:A.dateOfBirth),d=(T=t.profile)==null?void 0:T.fullName,i=(D=t.profile)==null?void 0:D.email,h=(O=t.profile)==null?void 0:O.phoneNumber,p=(K=t.profile)==null?void 0:K.dateOfBirth,g=(_=t.profile)==null?void 0:_.gender,u=t.relationship,v=(($=t.profile)==null?void 0:$.address)||"Chưa cập nhật",k=N=>(N==null?void 0:N.split(" ").map(I=>I.charAt(0)).join("").toUpperCase())||"?",b=Br(),R=Ee(),{mutate:E,isPending:q}=Ur({mutation:{onError:N=>{var I,j;W.error(((j=(I=N.response)==null?void 0:I.data)==null?void 0:j.message)||N.message)},onSuccess:()=>{W.success("Xóa thành viên thành công"),b.invalidateQueries({queryKey:zr(t.familyId)}),R.invalidate(),o(!1)}}}),F=()=>{var N;if(n){W.error("Không thể xóa chủ hộ");return}E({id:t.familyId,memberId:(N=t.profile)==null?void 0:N.id})};return e.jsxs(fr,{className:"overflow-hidden transition-all duration-300 hover:shadow-md",children:[e.jsx(gr,{className:"p-0",children:e.jsxs("div",{className:"relative h-28 bg-gradient-to-br from-primary/20 to-primary/40",children:[n&&e.jsx(jr,{className:"absolute top-2 right-2 bg-primary text-white",children:"Chủ hộ"}),e.jsx("div",{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2",children:e.jsxs(_n,{className:"h-24 block w-24 border-4 border-background rounded-full overflow-hidden shadow-sm",children:[e.jsx(Ln,{width:96,height:96,src:Nr(((M=t.profile)==null?void 0:M.avatarUrl)||"https://placewaifu.com/image/200"),alt:d,className:"object-cover"}),e.jsx(Hn,{className:"bg-primary/10 text-primary text-lg font-medium",children:k(d||"unknown")})]})})]})}),e.jsxs(vr,{className:"pt-10 pb-3 text-center",children:[e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:d||"Chưa cập nhật"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(mr,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tuổi & Giới tính"}),e.jsxs("p",{className:"text-sm font-medium",children:[x," tuổi • ",Es(g)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(en,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ngày sinh"}),e.jsx("p",{className:"text-sm font-medium",children:p?pe(p).format("DD/MM/YYYY"):"Chưa cập nhật"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(tn,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs text-muted-foreground ",children:"Địa chỉ"}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:v})]})]})]})]}),e.jsxs(vn,{className:"border-t px-4 py-3 bg-muted/5 flex flex-col gap-2",children:[e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rn,{className:"h-4 w-4 text-primary"}),e.jsxs(Ht,{children:[e.jsx($t,{asChild:!0,children:e.jsx("p",{className:"text-sm truncate max-w-[150px]",children:h||"Chưa cập nhật"})}),e.jsx(Gt,{children:e.jsx("p",{children:h||"Chưa cập nhật"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nn,{className:"h-4 w-4 text-primary"}),e.jsxs(Ht,{children:[e.jsx($t,{asChild:!0,children:e.jsx("p",{className:"text-sm truncate max-w-[150px]",children:i||"Chưa cập nhật"})}),e.jsx(Gt,{children:e.jsx("p",{children:i||"Chưa cập nhật"})})]})]})]}),e.jsxs("div",{className:"w-full flex justify-between mt-1",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1 mr-1",onClick:s,children:[e.jsx(sn,{className:"h-3.5 w-3.5 mr-1"}),"Hồ sơ thành viên"]}),r&&e.jsxs(yn,{children:[e.jsx(Nn,{asChild:!0,children:e.jsx(P,{variant:"outline",size:"sm",className:"px-2",children:e.jsx(an,{className:"h-3.5 w-3.5"})})}),e.jsxs(Cn,{align:"end",children:[e.jsxs(kt,{onClick:a,children:[e.jsx(ln,{className:"mr-2 h-4 w-4"}),"Chỉnh sửa thông tin"]}),e.jsx(wn,{}),e.jsxs(kt,{className:"text-destructive",disabled:n,onClick:()=>!n&&o(!0),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"Xóa thành viên"]})]})]})]})]}),e.jsx(rt,{open:c,onOpenChange:o,children:e.jsxs(nt,{children:[e.jsxs(st,{children:[e.jsx(at,{children:"Xác nhận xóa thành viên"}),e.jsxs(it,{children:["Bạn có chắc chắn muốn xóa thành viên"," ",e.jsx("span",{className:"font-semibold",children:d})," ","khỏi hộ gia đình? Hành động này không thể hoàn tác."]})]}),e.jsxs(lt,{children:[e.jsx(ot,{children:"Hủy"}),e.jsx(ct,{onClick:F,disabled:q,className:"bg-destructive hover:bg-destructive/90",children:q?"Đang xóa...":"Xóa thành viên"})]})]})})]})},ks=t=>{const n=pe(),r=pe(t),s=n.diff(r,"year");return s===0?n.diff(r,"month")+" tháng":s},Es=t=>{if(!t)return"Chưa cập nhật";switch(t.toUpperCase()){case"MALE":return"Nam";case"FEMALE":return"Nữ";default:return t}},Ds=(t,n,r)=>Yr({url:"/api/doctors",method:"GET",params:t,signal:r},n),Is=t=>["/api/doctors",...t?[t]:[]],Rs=(t,n)=>{const{query:r,request:s}=n??{};return{queryKey:(r==null?void 0:r.queryKey)??Is(t),queryFn:({signal:o})=>Ds(t,s,o),...r}};function As(t,n,r){const s=Rs(t,n),a=Kr(s);return a.queryKey=s.queryKey,a}function qe({className:t,...n}){return e.jsx("div",{"data-slot":"skeleton",className:ee("bg-accent animate-pulse rounded-md",t),...n})}var Oe,Vt;function Fr(){if(Vt)return Oe;Vt=1;function t(n){var r=typeof n;return n!=null&&(r=="object"||r=="function")}return Oe=t,Oe}var Me,Bt;function Fs(){if(Bt)return Me;Bt=1;var t=typeof ye=="object"&&ye&&ye.Object===Object&&ye;return Me=t,Me}var _e,Ut;function Pr(){if(Ut)return _e;Ut=1;var t=Fs(),n=typeof self=="object"&&self&&self.Object===Object&&self,r=t||n||Function("return this")();return _e=r,_e}var Le,zt;function Ps(){if(zt)return Le;zt=1;var t=Pr(),n=function(){return t.Date.now()};return Le=n,Le}var He,Kt;function qs(){if(Kt)return He;Kt=1;var t=/\s/;function n(r){for(var s=r.length;s--&&t.test(r.charAt(s)););return s}return He=n,He}var $e,Yt;function Os(){if(Yt)return $e;Yt=1;var t=qs(),n=/^\s+/;function r(s){return s&&s.slice(0,t(s)+1).replace(n,"")}return $e=r,$e}var Ge,Xt;function qr(){if(Xt)return Ge;Xt=1;var t=Pr(),n=t.Symbol;return Ge=n,Ge}var Ve,Wt;function Ms(){if(Wt)return Ve;Wt=1;var t=qr(),n=Object.prototype,r=n.hasOwnProperty,s=n.toString,a=t?t.toStringTag:void 0;function c(o){var x=r.call(o,a),d=o[a];try{o[a]=void 0;var i=!0}catch{}var h=s.call(o);return i&&(x?o[a]=d:delete o[a]),h}return Ve=c,Ve}var Be,Qt;function _s(){if(Qt)return Be;Qt=1;var t=Object.prototype,n=t.toString;function r(s){return n.call(s)}return Be=r,Be}var Ue,Jt;function Ls(){if(Jt)return Ue;Jt=1;var t=qr(),n=Ms(),r=_s(),s="[object Null]",a="[object Undefined]",c=t?t.toStringTag:void 0;function o(x){return x==null?x===void 0?a:s:c&&c in Object(x)?n(x):r(x)}return Ue=o,Ue}var ze,Zt;function Hs(){if(Zt)return ze;Zt=1;function t(n){return n!=null&&typeof n=="object"}return ze=t,ze}var Ke,er;function $s(){if(er)return Ke;er=1;var t=Ls(),n=Hs(),r="[object Symbol]";function s(a){return typeof a=="symbol"||n(a)&&t(a)==r}return Ke=s,Ke}var Ye,tr;function Gs(){if(tr)return Ye;tr=1;var t=Os(),n=Fr(),r=$s(),s=NaN,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,o=/^0o[0-7]+$/i,x=parseInt;function d(i){if(typeof i=="number")return i;if(r(i))return s;if(n(i)){var h=typeof i.valueOf=="function"?i.valueOf():i;i=n(h)?h+"":h}if(typeof i!="string")return i===0?i:+i;i=t(i);var p=c.test(i);return p||o.test(i)?x(i.slice(2),p?2:8):a.test(i)?s:+i}return Ye=d,Ye}var Xe,rr;function Vs(){if(rr)return Xe;rr=1;var t=Fr(),n=Ps(),r=Gs(),s="Expected a function",a=Math.max,c=Math.min;function o(x,d,i){var h,p,g,u,v,k,b=0,R=!1,E=!1,q=!0;if(typeof x!="function")throw new TypeError(s);d=r(d)||0,t(i)&&(R=!!i.leading,E="maxWait"in i,g=E?a(r(i.maxWait)||0,d):g,q="trailing"in i?!!i.trailing:q);function F(N){var I=h,j=p;return h=p=void 0,b=N,u=x.apply(j,I),u}function A(N){return b=N,v=setTimeout(O,d),R?F(N):u}function T(N){var I=N-k,j=N-b,G=d-I;return E?c(G,g-j):G}function D(N){var I=N-k,j=N-b;return k===void 0||I>=d||I<0||E&&j>=g}function O(){var N=n();if(D(N))return K(N);v=setTimeout(O,T(N))}function K(N){return v=void 0,q&&h?F(N):(h=p=void 0,u)}function _(){v!==void 0&&clearTimeout(v),b=0,h=k=p=v=void 0}function $(){return v===void 0?u:K(n())}function M(){var N=n(),I=D(N);if(h=arguments,p=this,k=N,I){if(v===void 0)return A(k);if(E)return clearTimeout(v),v=setTimeout(O,d),F(k)}return v===void 0&&(v=setTimeout(O,d)),u}return M.cancel=_,M.flush=$,M}return Xe=o,Xe}var Bs=Vs();const Us=Xr(Bs),zs=De({doctorId:Gn({required_error:"Vui lòng chọn bác sĩ"}),notes:Q().max(500,"Ghi chú không được vượt quá 500 ký tự").optional()});function Ks({familyId:t,isOpen:n,onSuccess:r,onClose:s}){var $,M,N,I;const[a,c]=l.useState(""),[o,x]=l.useState(1),[d,i]=l.useState(null),h=Ee(),{control:p,handleSubmit:g,formState:{errors:u},setValue:v,watch:k}=we({resolver:Te(zs),defaultValues:{doctorId:void 0,notes:""}}),{data:b,isLoading:R,refetch:E}=As({keyword:a,page:o-1,size:10},{query:{enabled:n}}),{mutate:q,isPending:F}=Un({mutation:{onSuccess:()=>{W.success("Đã gửi yêu cầu thành công",{duration:3e3}),s(),h.invalidate(),r==null||r()},onError:j=>{var G,J;W.error("Gửi yêu cầu thất bại",{duration:5e3,description:((J=(G=j.response)==null?void 0:G.data)==null?void 0:J.message)||j.message||"Đã có lỗi xảy ra"})}}}),A=Us(j=>{c(j),x(1)},500),T=j=>{A(j.target.value)},D=j=>{i({id:j.id,name:j.bio||`Bác sĩ #${j.id}`}),v("doctorId",j.id)},O=()=>{x(j=>j+1)},K=j=>{q({data:{doctorId:j.doctorId,familyId:t,notes:j.notes||""}})},_=k("doctorId");return e.jsx(Yn,{open:n,onOpenChange:s,children:e.jsxs(Xn,{className:"w-full sm:max-w-md overflow-y-auto px-4",children:[e.jsxs(Wn,{className:"mb-6",children:[e.jsx(Qn,{children:"Chọn bác sĩ quản lý"}),e.jsx(Jn,{children:"Tìm kiếm và chọn bác sĩ quản lý cho gia đình của bạn"})]}),e.jsxs("form",{onSubmit:g(K),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(on,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(H,{placeholder:"Tìm kiếm theo tên, chuyên khoa...",className:"pl-10",onChange:T})]}),d&&e.jsx("div",{className:"p-3 border rounded-md bg-muted/20 my-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(jr,{variant:"outline",className:"mr-2 bg-primary/10 text-primary",children:"Đã chọn"}),e.jsx("span",{className:"font-medium",children:d.name})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:a?`Kết quả tìm kiếm cho "${a}"`:"Danh sách bác sĩ"}),R?Array(3).fill(0).map((j,G)=>e.jsxs("div",{className:"flex items-center space-x-4 p-3 border rounded-md",children:[e.jsx(qe,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(qe,{className:"h-4 w-3/4"}),e.jsx(qe,{className:"h-3 w-1/2"})]})]},G)):(($=b==null?void 0:b.content)==null?void 0:$.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(mr,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"font-medium",children:"Không tìm thấy bác sĩ"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Vui lòng thử tìm kiếm với từ khóa khác"})]}):e.jsxs(e.Fragment,{children:[(M=b==null?void 0:b.content)==null?void 0:M.map(j=>e.jsxs("div",{className:`flex items-center p-3 border rounded-md cursor-pointer transition-colors ${_===j.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>D(j),children:[e.jsxs(dt,{className:"h-12 w-12 mr-4 border",children:[e.jsx(ut,{src:"https://placewaifu.com/image/300",alt:j.bio||""}),e.jsx(mt,{children:"BS"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-medium text-base",children:["BS."," ",j.bio||`#${j.id}`]}),_===j.id&&e.jsx(cn,{className:"h-5 w-5 text-primary"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[j.specialty&&e.jsxs("span",{className:"inline-flex items-center mr-2",children:[e.jsx(dn,{className:"h-3 w-3 mr-1"}),j.specialty]}),j.medicalFacility&&e.jsx("span",{children:j.medicalFacility})]})]})]},j.id)),((N=b==null?void 0:b.page)==null?void 0:N.totalPages)&&o<((I=b==null?void 0:b.page)==null?void 0:I.totalPages)&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(P,{type:"button",variant:"outline",size:"sm",onClick:O,children:"Xem thêm"})})]})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("label",{htmlFor:"notes",className:"text-sm font-medium",children:"Ghi chú (không bắt buộc)"}),e.jsx(gn,{name:"notes",control:p,render:({field:j})=>e.jsx(es,{id:"notes",placeholder:"Thêm ghi chú về lý do chọn bác sĩ này...",className:"resize-none",...j})}),u.notes&&e.jsx("p",{className:"text-sm text-destructive",children:u.notes.message})]})]}),e.jsxs(Zn,{className:"sm:justify-between gap-3 flex-row",children:[e.jsx(P,{type:"button",variant:"outline",className:"flex-1",onClick:s,children:"Hủy"}),e.jsx(P,{type:"submit",className:"flex-1",disabled:F||!_,children:F?e.jsxs(e.Fragment,{children:[e.jsx(un,{className:"mr-2 h-4 w-4 animate-spin"}),"Đang gửi..."]}):"Gửi yêu cầu"})]})]})]})})}const Ys=De({familyName:Q().min(3,{message:"Tên gia đình phải có từ 3 đến 255 ký tự"}).max(255,{message:"Tên gia đình phải có từ 3 đến 255 ký tự"}),address:Q().min(1,{message:"Địa chỉ không được để trống"}).max(500,{message:"Địa chỉ không được vượt quá 500 ký tự"}),phoneNumber:Q().min(1,{message:"Số điện thoại không được để trống"}).regex(/^(\+84|0)[3|5|7|8|9][0-9]{8}$/,{message:"Số điện thoại không hợp lệ"}),email:Q().min(1,{message:"Email không được để trống"}).max(100,{message:"Email không được vượt quá 100 ký tự"}).email({message:"Email không hợp lệ"})});function Xs({family:t}){var O,K,_,$,M,N,I,j,G,J,oe,ce,de,ue,m,y,w;const[n,r]=l.useState(!1),[s,a]=l.useState(!1),[c,o]=l.useState(!1),[x,d]=l.useState(!1),i=Ee(),h=ur(),p=(t.familyMembers||[]).find(f=>f.relationship==="Chủ hộ"),{data:g,refetch:u}=zn({familyId:t.id},{query:{enabled:!!t.id}}),v=we({resolver:Te(Ys),defaultValues:{familyName:t.familyName||"",address:t.address||"",phoneNumber:t.phoneNumber||"",email:t.email||""}}),{mutate:k,isPending:b}=Wr({mutation:{onSuccess:()=>{W.success("Đã xoá gia đình",{duration:3e3}),a(!1),h({to:"/home/families"})},onError:f=>{var C,S;W.error("Xoá gia đình thất bại",{duration:5e3,description:((S=(C=f.response)==null?void 0:C.data)==null?void 0:S.message)||f.message||"Đã có lỗi xảy ra"})}}}),{mutate:R,isPending:E}=Qr({mutation:{onSuccess:()=>{W.success("Đã cập nhật thông tin gia đình",{duration:3e3}),r(!1),i.invalidate()},onError:f=>{var C,S;W.error("Cập nhật thông tin gia đình thất bại",{duration:5e3,description:((S=(C=f.response)==null?void 0:C.data)==null?void 0:S.message)||f.message||"Đã có lỗi xảy ra"})}}}),q=async f=>{E||R({id:t.id+"",data:{...f}})},F=()=>{b||k({id:t.id+""})},{mutateAsync:A,isPending:T}=Kn({mutation:{onSuccess:()=>{W.success("Đã xoá bác sĩ quản lý khỏi gia đình",{duration:3e3}),o(!1),i.invalidate(),u()},onError:f=>{var C,S;W.error("Xoá bác sĩ quản lý thất bại",{duration:5e3,description:((S=(C=f.response)==null?void 0:C.data)==null?void 0:S.message)||f.message||"Đã có lỗi xảy ra"})}}}),D=()=>{T||!g||A({id:g.id})};return e.jsxs(e.Fragment,{children:[e.jsxs(fr,{className:"overflow-hidden",children:[e.jsxs(gr,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(jn,{className:"flex items-center",children:[e.jsx(mn,{className:"mr-2 h-5 w-5"}),"Thông tin gia đình"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(he,{I:"update",a:xe("FamilyProfile",{...t}),children:e.jsxs(P,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>r(!0),children:[e.jsx(hn,{className:"h-4 w-4"}),"Sửa"]})}),e.jsx(he,{I:"delete",a:xe("FamilyProfile",{...t}),children:e.jsxs(P,{variant:"destructive",size:"sm",className:"flex items-center gap-1",onClick:()=>a(!0),children:[e.jsx(Ze,{className:"h-4 w-4"}),"Xoá"]})})]})]}),e.jsx(bn,{children:"Chi tiết về hộ gia đình của bạn"})]}),e.jsxs(vr,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Tên gọi"}),e.jsx("p",{className:"font-medium",children:t.familyName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Ngày tạo"}),e.jsx("p",{className:"font-medium",children:pe(t.createdAt||void 0).format("DD/MM/YYYY")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Địa chỉ"}),e.jsx("p",{className:"font-medium",children:t.address})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Số thành viên"}),e.jsx("p",{className:"font-medium",children:((O=t.familyMembers)==null?void 0:O.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Số điện thoại liên hệ"}),e.jsx("p",{className:"font-medium",children:t.phoneNumber||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Email liên hệ"}),e.jsx("p",{className:"font-medium",children:t.email||"—"})]})]})]}),e.jsx($n,{className:"my-6"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(xn,{className:"mr-2 h-5 w-5"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Chủ hộ"})]}),p?e.jsxs("div",{className:"flex items-center p-3 bg-muted/20 rounded-lg",children:[e.jsxs(dt,{className:"h-12 w-12 mr-4 border",children:[e.jsx(ut,{src:Nr(((K=p.profile)==null?void 0:K.avatarUrl)||"https://placewaifu.com/image/200"),alt:((_=p.profile)==null?void 0:_.fullName)||""}),e.jsx(mt,{children:((M=($=p.profile)==null?void 0:$.fullName)==null?void 0:M.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-base",children:((N=p.profile)==null?void 0:N.fullName)||"Chưa cập nhật"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(I=p.profile)==null?void 0:I.phoneNumber,((j=p.profile)==null?void 0:j.phoneNumber)&&((G=p.profile)==null?void 0:G.email)&&" • ",(J=p.profile)==null?void 0:J.email]})]})]}):e.jsx("p",{className:"text-muted-foreground italic",children:"Chưa có thông tin chủ hộ"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(et,{className:"mr-2 h-5 w-5"}),e.jsx("h3",{className:"font-semibold text-lg",children:"Bác sĩ quản lý"})]}),e.jsx("div",{children:g&&e.jsx(he,{I:"manage",an:xe("FamilyDoctor",{...t}),children:e.jsxs(P,{variant:"destructive",size:"sm",className:"flex items-center gap-1",onClick:()=>o(!0),children:[e.jsx(Ze,{className:"h-4 w-4"}),"Gỡ bỏ bác sĩ"]})})})]}),!g&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>d(!0),children:[e.jsx(et,{className:"h-4 w-4"}),"Thêm bác sĩ"]}),e.jsx(Ks,{familyId:t.id,isOpen:x,onClose:()=>d(!1),onSuccess:()=>u()})]})]}),g?e.jsxs("div",{className:"p-3 bg-muted/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(dt,{className:"h-12 w-12 mr-4 border",children:[e.jsx(ut,{src:"https://placewaifu.com/image/300",alt:((oe=g.doctor)==null?void 0:oe.bio)||""}),e.jsx(mt,{children:"BS"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-base",children:["BS."," ",((ce=g.doctor)==null?void 0:ce.bio)||""]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[((de=g.doctor)==null?void 0:de.specialty)||"",((ue=g.doctor)==null?void 0:ue.specialty)&&" • ","Số giấy phép:"," ",((m=g.doctor)==null?void 0:m.licenseNumber)||""]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Cơ sở y tế"}),e.jsx("p",{className:"text-sm",children:((y=g.doctor)==null?void 0:y.medicalFacility)||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Ngày bắt đầu quản lý"}),e.jsx("p",{className:"text-sm",children:g.createdAt?pe(g.createdAt).format("DD/MM/YYYY"):"—"})]}),g.status&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Trạng thái"}),e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs ${g.status===_t.ACCEPTED?"bg-green-100 text-green-800":g.status==="PENDING"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:g.status===_t.ACCEPTED?"Đang hoạt động":g.status==="PENDING"?"Chờ xác nhận":g.status})]}),g.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Ghi chú"}),e.jsx("p",{className:"text-sm",children:g.notes})]})]})]}):e.jsx("p",{className:"text-muted-foreground italic",children:"Chưa có bác sĩ quản lý cho gia đình này"})]})]})]}),e.jsx(tt,{open:n,onOpenChange:r,children:e.jsxs(jt,{className:"sm:max-w-[500px]",children:[e.jsxs(bt,{children:[e.jsx(yt,{children:"Chỉnh sửa thông tin gia đình"}),e.jsx(Nt,{children:"Cập nhật thông tin chi tiết về gia đình của bạn"})]}),e.jsx(ht,{...v,children:e.jsxs("form",{onSubmit:v.handleSubmit(q),className:"space-y-4",children:[e.jsx(V,{control:v.control,name:"familyName",render:({field:f})=>e.jsxs(B,{children:[e.jsx(U,{children:"Tên gia đình"}),e.jsx(z,{children:e.jsx(H,{...f,placeholder:"Nhập tên gia đình"})}),e.jsx(X,{})]})}),e.jsx(V,{control:v.control,name:"address",render:({field:f})=>e.jsxs(B,{children:[e.jsx(U,{children:"Địa chỉ"}),e.jsx(z,{children:e.jsx(H,{...f,placeholder:"Nhập địa chỉ"})}),e.jsx(X,{})]})}),e.jsx(V,{control:v.control,name:"phoneNumber",render:({field:f})=>e.jsxs(B,{children:[e.jsx(U,{children:"Số điện thoại liên hệ"}),e.jsx(z,{children:e.jsx(H,{...f,placeholder:"Nhập số điện thoại",type:"tel"})}),e.jsx(X,{})]})}),e.jsx(V,{control:v.control,name:"email",render:({field:f})=>e.jsxs(B,{children:[e.jsx(U,{children:"Email"}),e.jsx(z,{children:e.jsx(H,{...f,placeholder:"Nhập email",type:"email"})}),e.jsx(X,{})]})}),e.jsxs(Ce,{children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Huỷ bỏ"}),e.jsx(P,{type:"submit",disabled:E,children:E?"Đang lưu...":"Lưu thay đổi"})]})]})})]})}),e.jsx(rt,{open:s,onOpenChange:a,children:e.jsxs(nt,{children:[e.jsxs(st,{children:[e.jsx(at,{children:"Xác nhận xoá gia đình"}),e.jsxs(it,{children:['Bạn có chắc chắn muốn xoá gia đình "',t.familyName,'"? Hành động này không thể hoàn tác và tất cả dữ liệu liên quan sẽ bị xoá vĩnh viễn.']})]}),e.jsxs(lt,{children:[e.jsx(ot,{children:"Huỷ bỏ"}),e.jsx(ct,{onClick:F,disabled:b,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:b?"Đang xoá...":"Xoá gia đình"})]})]})}),e.jsx(rt,{open:c,onOpenChange:o,children:e.jsxs(nt,{children:[e.jsxs(st,{children:[e.jsx(at,{children:"Xác nhận gỡ bỏ bác sĩ quản lý"}),e.jsxs(it,{children:['Bạn có chắc chắn muốn gỡ bỏ bác sĩ "',((w=g==null?void 0:g.doctor)==null?void 0:w.bio)||"",'" khỏi gia đình của bạn? Hành động này sẽ huỷ bỏ liên kết giữa bác sĩ và gia đình.']})]}),e.jsxs(lt,{children:[e.jsx(ot,{children:"Huỷ bỏ"}),e.jsx(ct,{onClick:D,disabled:T,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:T?"Đang gỡ bỏ...":"Gỡ bỏ bác sĩ"})]})]})})]})}var nr=1,Ws=.9,Qs=.8,Js=.17,We=.1,Qe=.999,Zs=.9999,ea=.99,ta=/[\\\/_+.#"@\[\(\{&]/,ra=/[\\\/_+.#"@\[\(\{&]/g,na=/[\s-]/,Or=/[\s-]/g;function gt(t,n,r,s,a,c,o){if(c===n.length)return a===t.length?nr:ea;var x=`${a},${c}`;if(o[x]!==void 0)return o[x];for(var d=s.charAt(c),i=r.indexOf(d,a),h=0,p,g,u,v;i>=0;)p=gt(t,n,r,s,i+1,c+1,o),p>h&&(i===a?p*=nr:ta.test(t.charAt(i-1))?(p*=Qs,u=t.slice(a,i-1).match(ra),u&&a>0&&(p*=Math.pow(Qe,u.length))):na.test(t.charAt(i-1))?(p*=Ws,v=t.slice(a,i-1).match(Or),v&&a>0&&(p*=Math.pow(Qe,v.length))):(p*=Js,a>0&&(p*=Math.pow(Qe,i-a))),t.charAt(i)!==n.charAt(c)&&(p*=Zs)),(p<We&&r.charAt(i-1)===s.charAt(c+1)||s.charAt(c+1)===s.charAt(c)&&r.charAt(i-1)!==s.charAt(c))&&(g=gt(t,n,r,s,i+1,c+2,o),g*We>p&&(p=g*We)),p>h&&(h=p),i=r.indexOf(d,i+1);return o[x]=h,h}function sr(t){return t.toLowerCase().replace(Or," ")}function sa(t,n,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,gt(t,n,sr(t),sr(n),0,0,{})}var me='[cmdk-group=""]',Je='[cmdk-group-items=""]',aa='[cmdk-group-heading=""]',Mr='[cmdk-item=""]',ar=`${Mr}:not([aria-disabled="true"])`,vt="cmdk-item-select",ae="data-value",ia=(t,n,r)=>sa(t,n,r),_r=l.createContext(void 0),je=()=>l.useContext(_r),Lr=l.createContext(void 0),Tt=()=>l.useContext(Lr),Hr=l.createContext(void 0),$r=l.forwardRef((t,n)=>{let r=ie(()=>{var m,y;return{search:"",value:(y=(m=t.value)!=null?m:t.defaultValue)!=null?y:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),s=ie(()=>new Set),a=ie(()=>new Map),c=ie(()=>new Map),o=ie(()=>new Set),x=Gr(t),{label:d,children:i,value:h,onValueChange:p,filter:g,shouldFilter:u,loop:v,disablePointerSelection:k=!1,vimBindings:b=!0,...R}=t,E=re(),q=re(),F=re(),A=l.useRef(null),T=ga();ne(()=>{if(h!==void 0){let m=h.trim();r.current.value=m,D.emit()}},[h]),ne(()=>{T(6,N)},[]);let D=l.useMemo(()=>({subscribe:m=>(o.current.add(m),()=>o.current.delete(m)),snapshot:()=>r.current,setState:(m,y,w)=>{var f,C,S,Y;if(!Object.is(r.current[m],y)){if(r.current[m]=y,m==="search")M(),_(),T(1,$);else if(m==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let L=document.getElementById(F);L?L.focus():(f=document.getElementById(E))==null||f.focus()}if(T(7,()=>{var L;r.current.selectedItemId=(L=I())==null?void 0:L.id,D.emit()}),w||T(5,N),((C=x.current)==null?void 0:C.value)!==void 0){let L=y??"";(Y=(S=x.current).onValueChange)==null||Y.call(S,L);return}}D.emit()}},emit:()=>{o.current.forEach(m=>m())}}),[]),O=l.useMemo(()=>({value:(m,y,w)=>{var f;y!==((f=c.current.get(m))==null?void 0:f.value)&&(c.current.set(m,{value:y,keywords:w}),r.current.filtered.items.set(m,K(y,w)),T(2,()=>{_(),D.emit()}))},item:(m,y)=>(s.current.add(m),y&&(a.current.has(y)?a.current.get(y).add(m):a.current.set(y,new Set([m]))),T(3,()=>{M(),_(),r.current.value||$(),D.emit()}),()=>{c.current.delete(m),s.current.delete(m),r.current.filtered.items.delete(m);let w=I();T(4,()=>{M(),(w==null?void 0:w.getAttribute("id"))===m&&$(),D.emit()})}),group:m=>(a.current.has(m)||a.current.set(m,new Set),()=>{c.current.delete(m),a.current.delete(m)}),filter:()=>x.current.shouldFilter,label:d||t["aria-label"],getDisablePointerSelection:()=>x.current.disablePointerSelection,listId:E,inputId:F,labelId:q,listInnerRef:A}),[]);function K(m,y){var w,f;let C=(f=(w=x.current)==null?void 0:w.filter)!=null?f:ia;return m?C(m,r.current.search,y):0}function _(){if(!r.current.search||x.current.shouldFilter===!1)return;let m=r.current.filtered.items,y=[];r.current.filtered.groups.forEach(f=>{let C=a.current.get(f),S=0;C.forEach(Y=>{let L=m.get(Y);S=Math.max(L,S)}),y.push([f,S])});let w=A.current;j().sort((f,C)=>{var S,Y;let L=f.getAttribute("id"),be=C.getAttribute("id");return((S=m.get(be))!=null?S:0)-((Y=m.get(L))!=null?Y:0)}).forEach(f=>{let C=f.closest(Je);C?C.appendChild(f.parentElement===C?f:f.closest(`${Je} > *`)):w.appendChild(f.parentElement===w?f:f.closest(`${Je} > *`))}),y.sort((f,C)=>C[1]-f[1]).forEach(f=>{var C;let S=(C=A.current)==null?void 0:C.querySelector(`${me}[${ae}="${encodeURIComponent(f[0])}"]`);S==null||S.parentElement.appendChild(S)})}function $(){let m=j().find(w=>w.getAttribute("aria-disabled")!=="true"),y=m==null?void 0:m.getAttribute(ae);D.setState("value",y||void 0)}function M(){var m,y,w,f;if(!r.current.search||x.current.shouldFilter===!1){r.current.filtered.count=s.current.size;return}r.current.filtered.groups=new Set;let C=0;for(let S of s.current){let Y=(y=(m=c.current.get(S))==null?void 0:m.value)!=null?y:"",L=(f=(w=c.current.get(S))==null?void 0:w.keywords)!=null?f:[],be=K(Y,L);r.current.filtered.items.set(S,be),be>0&&C++}for(let[S,Y]of a.current)for(let L of Y)if(r.current.filtered.items.get(L)>0){r.current.filtered.groups.add(S);break}r.current.filtered.count=C}function N(){var m,y,w;let f=I();f&&(((m=f.parentElement)==null?void 0:m.firstChild)===f&&((w=(y=f.closest(me))==null?void 0:y.querySelector(aa))==null||w.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function I(){var m;return(m=A.current)==null?void 0:m.querySelector(`${Mr}[aria-selected="true"]`)}function j(){var m;return Array.from(((m=A.current)==null?void 0:m.querySelectorAll(ar))||[])}function G(m){let y=j()[m];y&&D.setState("value",y.getAttribute(ae))}function J(m){var y;let w=I(),f=j(),C=f.findIndex(Y=>Y===w),S=f[C+m];(y=x.current)!=null&&y.loop&&(S=C+m<0?f[f.length-1]:C+m===f.length?f[0]:f[C+m]),S&&D.setState("value",S.getAttribute(ae))}function oe(m){let y=I(),w=y==null?void 0:y.closest(me),f;for(;w&&!f;)w=m>0?pa(w,me):fa(w,me),f=w==null?void 0:w.querySelector(ar);f?D.setState("value",f.getAttribute(ae)):J(m)}let ce=()=>G(j().length-1),de=m=>{m.preventDefault(),m.metaKey?ce():m.altKey?oe(1):J(1)},ue=m=>{m.preventDefault(),m.metaKey?G(0):m.altKey?oe(-1):J(-1)};return l.createElement(Z.div,{ref:n,tabIndex:-1,...R,"cmdk-root":"",onKeyDown:m=>{var y;(y=R.onKeyDown)==null||y.call(R,m);let w=m.nativeEvent.isComposing||m.keyCode===229;if(!(m.defaultPrevented||w))switch(m.key){case"n":case"j":{b&&m.ctrlKey&&de(m);break}case"ArrowDown":{de(m);break}case"p":case"k":{b&&m.ctrlKey&&ue(m);break}case"ArrowUp":{ue(m);break}case"Home":{m.preventDefault(),G(0);break}case"End":{m.preventDefault(),ce();break}case"Enter":{m.preventDefault();let f=I();if(f){let C=new Event(vt);f.dispatchEvent(C)}}}}},l.createElement("label",{"cmdk-label":"",htmlFor:O.inputId,id:O.labelId,style:ja},d),Fe(t,m=>l.createElement(Lr.Provider,{value:D},l.createElement(_r.Provider,{value:O},m))))}),la=l.forwardRef((t,n)=>{var r,s;let a=re(),c=l.useRef(null),o=l.useContext(Hr),x=je(),d=Gr(t),i=(s=(r=d.current)==null?void 0:r.forceMount)!=null?s:o==null?void 0:o.forceMount;ne(()=>{if(!i)return x.item(a,o==null?void 0:o.id)},[i]);let h=Vr(a,c,[t.value,t.children,c],t.keywords),p=Tt(),g=te(T=>T.value&&T.value===h.current),u=te(T=>i||x.filter()===!1?!0:T.search?T.filtered.items.get(a)>0:!0);l.useEffect(()=>{let T=c.current;if(!(!T||t.disabled))return T.addEventListener(vt,v),()=>T.removeEventListener(vt,v)},[u,t.onSelect,t.disabled]);function v(){var T,D;k(),(D=(T=d.current).onSelect)==null||D.call(T,h.current)}function k(){p.setState("value",h.current,!0)}if(!u)return null;let{disabled:b,value:R,onSelect:E,forceMount:q,keywords:F,...A}=t;return l.createElement(Z.div,{ref:fe(c,n),...A,id:a,"cmdk-item":"",role:"option","aria-disabled":!!b,"aria-selected":!!g,"data-disabled":!!b,"data-selected":!!g,onPointerMove:b||x.getDisablePointerSelection()?void 0:k,onClick:b?void 0:v},t.children)}),oa=l.forwardRef((t,n)=>{let{heading:r,children:s,forceMount:a,...c}=t,o=re(),x=l.useRef(null),d=l.useRef(null),i=re(),h=je(),p=te(u=>a||h.filter()===!1?!0:u.search?u.filtered.groups.has(o):!0);ne(()=>h.group(o),[]),Vr(o,x,[t.value,t.heading,d]);let g=l.useMemo(()=>({id:o,forceMount:a}),[a]);return l.createElement(Z.div,{ref:fe(x,n),...c,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},r&&l.createElement("div",{ref:d,"cmdk-group-heading":"","aria-hidden":!0,id:i},r),Fe(t,u=>l.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?i:void 0},l.createElement(Hr.Provider,{value:g},u))))}),ca=l.forwardRef((t,n)=>{let{alwaysRender:r,...s}=t,a=l.useRef(null),c=te(o=>!o.search);return!r&&!c?null:l.createElement(Z.div,{ref:fe(a,n),...s,"cmdk-separator":"",role:"separator"})}),da=l.forwardRef((t,n)=>{let{onValueChange:r,...s}=t,a=t.value!=null,c=Tt(),o=te(i=>i.search),x=te(i=>i.selectedItemId),d=je();return l.useEffect(()=>{t.value!=null&&c.setState("search",t.value)},[t.value]),l.createElement(Z.input,{ref:n,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":d.listId,"aria-labelledby":d.labelId,"aria-activedescendant":x,id:d.inputId,type:"text",value:a?t.value:o,onChange:i=>{a||c.setState("search",i.target.value),r==null||r(i.target.value)}})}),ua=l.forwardRef((t,n)=>{let{children:r,label:s="Suggestions",...a}=t,c=l.useRef(null),o=l.useRef(null),x=te(i=>i.selectedItemId),d=je();return l.useEffect(()=>{if(o.current&&c.current){let i=o.current,h=c.current,p,g=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let u=i.offsetHeight;h.style.setProperty("--cmdk-list-height",u.toFixed(1)+"px")})});return g.observe(i),()=>{cancelAnimationFrame(p),g.unobserve(i)}}},[]),l.createElement(Z.div,{ref:fe(c,n),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":x,"aria-label":s,id:d.listId},Fe(t,i=>l.createElement("div",{ref:fe(o,d.listInnerRef),"cmdk-list-sizer":""},i)))}),ma=l.forwardRef((t,n)=>{let{open:r,onOpenChange:s,overlayClassName:a,contentClassName:c,container:o,...x}=t;return l.createElement(Dn,{open:r,onOpenChange:s},l.createElement(In,{container:o},l.createElement(Rn,{"cmdk-overlay":"",className:a}),l.createElement(An,{"aria-label":t.label,"cmdk-dialog":"",className:c},l.createElement($r,{ref:n,...x}))))}),ha=l.forwardRef((t,n)=>te(r=>r.filtered.count===0)?l.createElement(Z.div,{ref:n,...t,"cmdk-empty":"",role:"presentation"}):null),xa=l.forwardRef((t,n)=>{let{progress:r,children:s,label:a="Loading...",...c}=t;return l.createElement(Z.div,{ref:n,...c,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},Fe(t,o=>l.createElement("div",{"aria-hidden":!0},o)))}),Ae=Object.assign($r,{List:ua,Item:la,Input:da,Group:oa,Separator:ca,Dialog:ma,Empty:ha,Loading:xa});function pa(t,n){let r=t.nextElementSibling;for(;r;){if(r.matches(n))return r;r=r.nextElementSibling}}function fa(t,n){let r=t.previousElementSibling;for(;r;){if(r.matches(n))return r;r=r.previousElementSibling}}function Gr(t){let n=l.useRef(t);return ne(()=>{n.current=t}),n}var ne=typeof window>"u"?l.useEffect:l.useLayoutEffect;function ie(t){let n=l.useRef();return n.current===void 0&&(n.current=t()),n}function te(t){let n=Tt(),r=()=>t(n.snapshot());return l.useSyncExternalStore(n.subscribe,r,r)}function Vr(t,n,r,s=[]){let a=l.useRef(),c=je();return ne(()=>{var o;let x=(()=>{var i;for(let h of r){if(typeof h=="string")return h.trim();if(typeof h=="object"&&"current"in h)return h.current?(i=h.current.textContent)==null?void 0:i.trim():a.current}})(),d=s.map(i=>i.trim());c.value(t,x,d),(o=n.current)==null||o.setAttribute(ae,x),a.current=x}),a}var ga=()=>{let[t,n]=l.useState(),r=ie(()=>new Map);return ne(()=>{r.current.forEach(s=>s()),r.current=new Map},[t]),(s,a)=>{r.current.set(s,a),n({})}};function va(t){let n=t.type;return typeof n=="function"?n(t.props):"render"in n?n.render(t.props):t}function Fe({asChild:t,children:n},r){return t&&l.isValidElement(n)?l.cloneElement(va(n),{ref:n.ref},r(n.props.children)):r(n)}var ja={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function ir({className:t,...n}){return e.jsx(Ae,{"data-slot":"command",className:ee("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",t),...n})}function lr({className:t,...n}){return e.jsx(Ae.List,{"data-slot":"command-list",className:ee("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",t),...n})}function or({className:t,...n}){return e.jsx(Ae.Group,{"data-slot":"command-group",className:ee("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",t),...n})}function cr({className:t,...n}){return e.jsx(Ae.Item,{"data-slot":"command-item",className:ee("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}const dr=["Vợ/Chồng","Con trai","Con gái","Cha","Mẹ","Ông","Bà","Anh/Chị","Em","Cháu","Bác","Chú/Dì"],ba=De({fullName:Q().min(2,{message:"Họ và tên phải có ít nhất 2 ký tự"}).max(100,{message:"Họ và tên không được vượt quá 100 ký tự"}),relationship:Q({required_error:"Vui lòng chọn quan hệ với chủ hộ"}),gender:Vn(xt,{required_error:"Vui lòng chọn giới tính"}),birthDate:Q().refine(t=>{const n=new Date(t);return!isNaN(n.getTime())},{message:"Ngày sinh không hợp lệ"}),phoneNumber:Q().regex(/^(\+84|0)[3|5|7|8|9][0-9]{8}$/,{message:"Số điện thoại không hợp lệ"}).optional().or(At("")),email:Q().email({message:"Email không hợp lệ"}).max(100,{message:"Email không được vượt quá 100 ký tự"}).optional().or(At("")),isHouseholder:Cr().default(!1)}),ya=De({userId:Bn.number({required_error:"Vui lòng chọn người dùng"}),relationship:Q({required_error:"Vui lòng chọn quan hệ với chủ hộ"}),isHouseholder:Cr().default(!1)}),Na=({family:t,onClose:n,onSuccess:r})=>{const[s,a]=l.useState("new"),c=Ee(),{mutate:o,isPending:x}=Jr({mutation:{onSuccess:()=>{r==null||r(),n(),c.invalidate()},onError:u=>{W.error(`Có lỗi xảy ra khi thêm thành viên: ${u.message}`),n()}}}),d=we({resolver:Te(ba),defaultValues:{fullName:"",relationship:"",gender:void 0,birthDate:"",phoneNumber:"",email:"",isHouseholder:!1}}),i=we({resolver:Te(ya),defaultValues:{userId:void 0,relationship:"",isHouseholder:!1}}),h=[{id:"1",name:"Nguyễn Văn A",email:"a@example.com"},{id:"2",name:"Trần Thị B",email:"b@example.com"},{id:"3",name:"Lê Văn C",email:"c@example.com"}],p=u=>{o({id:t.id,data:{familyId:t.id,relationship:u.relationship,hasAccount:!1,householder:!1,memberProfile:i.getValues("userId")?void 0:{birthDate:u.birthDate,fullName:u.fullName,phoneNumber:u.phoneNumber,gender:u.gender,email:u.email}}})},g=u=>{o({id:t.id,data:{familyId:t.id,relationship:u.relationship,hasAccount:!0,accountId:u.userId,householder:u.isHouseholder,memberProfile:void 0}})};return e.jsxs(jt,{className:"sm:max-w-xl",children:[e.jsxs(bt,{children:[e.jsx(yt,{children:"Thêm thành viên gia đình"}),e.jsx(Nt,{children:"Thêm thành viên gia đình đã có tài khoản hoặc tạo thành viên mới"})]}),e.jsxs(xr,{value:s,onValueChange:a,className:"mt-6",children:[e.jsxs(pr,{className:"grid grid-cols-2 mb-6 w-full",children:[e.jsx(Se,{value:"new",children:"Thành viên mới"}),e.jsx(Se,{value:"existing",children:"Thành viên đã có tài khoản"})]}),e.jsx(ke,{value:"new",children:e.jsx(ht,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(p),className:"space-y-4",children:[e.jsx(V,{control:d.control,name:"fullName",render:({field:u})=>e.jsxs(B,{children:[e.jsx(U,{children:"Họ và tên"}),e.jsx(z,{children:e.jsx(H,{placeholder:"Nhập họ và tên",...u})}),e.jsx(X,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(V,{control:d.control,name:"relationship",render:({field:u})=>e.jsxs(B,{className:"flex flex-col",children:[e.jsx(U,{children:"Quan hệ với chủ hộ"}),e.jsxs(Ft,{children:[e.jsx(Pt,{asChild:!0,children:e.jsx(z,{children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{placeholder:"Nhập quan hệ với chủ hộ",...u}),e.jsx(P,{variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2",type:"button",children:e.jsx(Lt,{className:"h-4 w-4 opacity-50"})})]})})}),e.jsx(qt,{className:"w-[200px] p-0",align:"start",children:e.jsx(ir,{children:e.jsx(lr,{children:e.jsx(or,{children:dr.map(v=>e.jsxs(cr,{value:v,onSelect:()=>{d.setValue("relationship",v)},children:[e.jsx(Mt,{className:ee("mr-2 h-4 w-4",u.value===v?"opacity-100":"opacity-0")}),v]},v))})})})})]}),e.jsx(X,{})]})}),e.jsx(V,{control:d.control,name:"gender",render:({field:u})=>e.jsxs(B,{children:[e.jsx(U,{children:"Giới tính"}),e.jsxs(Et,{onValueChange:u.onChange,defaultValue:u.value,children:[e.jsx(z,{children:e.jsx(Dt,{className:"w-full",children:e.jsx(It,{placeholder:"Chọn giới tính"})})}),e.jsxs(Rt,{children:[e.jsx(Pe,{value:xt.MALE,children:"Nam"}),e.jsx(Pe,{value:xt.FEMALE,children:"Nữ"})]})]}),e.jsx(X,{})]})})]}),e.jsx(V,{control:d.control,name:"birthDate",render:({field:u})=>e.jsxs(B,{children:[e.jsx(U,{children:"Ngày sinh"}),e.jsx(z,{children:e.jsx(H,{type:"date",...u})}),e.jsx(X,{})]})}),e.jsx(V,{control:d.control,name:"phoneNumber",render:({field:u})=>e.jsxs(B,{children:[e.jsx(U,{children:"Số điện thoại (không bắt buộc)"}),e.jsx(z,{children:e.jsx(H,{placeholder:"Nhập số điện thoại",...u})}),e.jsx(X,{})]})}),e.jsx(V,{control:d.control,name:"email",render:({field:u})=>e.jsxs(B,{children:[e.jsx(U,{children:"Email (không bắt buộc)"}),e.jsx(z,{children:e.jsx(H,{type:"email",placeholder:"Nhập email",...u})}),e.jsx(X,{})]})}),e.jsx(V,{control:d.control,name:"isHouseholder",render:({field:u})=>e.jsxs(B,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(U,{children:"Đặt làm chủ hộ"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Người này sẽ trở thành chủ hộ mới của gia đình"})]}),e.jsx(z,{children:e.jsx(Ot,{checked:u.value,onCheckedChange:u.onChange})})]})}),e.jsxs(Ce,{className:"mt-6",children:[e.jsx(P,{type:"button",variant:"outline",onClick:n,children:"Hủy"}),e.jsx(P,{type:"submit",disabled:x,children:x?"Đang xử lý...":"Thêm thành viên"})]})]})})}),e.jsx(ke,{value:"existing",children:e.jsx(ht,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(g),className:"space-y-4",children:[e.jsx(V,{control:i.control,name:"userId",render:({field:u})=>e.jsxs(B,{children:[e.jsx(U,{children:"Chọn người dùng"}),e.jsxs(Et,{onValueChange:u.onChange,defaultValue:u.value+"",children:[e.jsx(z,{children:e.jsx(Dt,{className:"w-full",children:e.jsx(It,{placeholder:"Chọn người dùng"})})}),e.jsx(Rt,{children:h.map(v=>e.jsxs(Pe,{value:v.id,children:[v.name," (",v.email,")"]},v.id))})]}),e.jsx(X,{})]})}),e.jsx(V,{control:i.control,name:"relationship",render:({field:u})=>e.jsxs(B,{className:"flex flex-col",children:[e.jsx(U,{children:"Quan hệ với chủ hộ"}),e.jsxs(Ft,{children:[e.jsx(Pt,{asChild:!0,children:e.jsx(z,{children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{placeholder:"Nhập quan hệ với chủ hộ",...u}),e.jsx(P,{variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2",type:"button",children:e.jsx(Lt,{className:"h-4 w-4 opacity-50"})})]})})}),e.jsx(qt,{className:"w-[200px] p-0",align:"start",children:e.jsx(ir,{children:e.jsx(lr,{children:e.jsx(or,{children:dr.map(v=>e.jsxs(cr,{value:v,onSelect:()=>{i.setValue("relationship",v)},children:[e.jsx(Mt,{className:ee("mr-2 h-4 w-4",u.value===v?"opacity-100":"opacity-0")}),v]},v))})})})})]}),e.jsx(X,{})]})}),e.jsx(V,{control:i.control,name:"isHouseholder",render:({field:u})=>e.jsxs(B,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(U,{children:"Đặt làm chủ hộ"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Người này sẽ trở thành chủ hộ mới của gia đình"})]}),e.jsx(z,{children:e.jsx(Ot,{checked:u.value,onCheckedChange:u.onChange})})]})}),e.jsxs(Ce,{className:"mt-6",children:[e.jsx(P,{type:"button",variant:"outline",onClick:n,children:"Hủy"}),e.jsx(P,{type:"submit",disabled:x,children:x?"Đang xử lý...":"Thêm thành viên"})]})]})})})]})]})},Ca=({family:t})=>{const[n,r]=l.useState("members"),[s,a]=l.useState(!1),[c,o]=l.useState(!1);St(h=>h.ability);const x=St(h=>{var p,g,u;return((g=(p=h.profile)==null?void 0:p.profile)==null?void 0:g.id)||((u=h.profile)==null?void 0:u.id)}),d=h=>{o(!1)},i=ur();return e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"mb-2",children:e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Gia đình: ",t.familyName]})})}),e.jsxs(xr,{value:n,onValueChange:r,className:"space-y-6",children:[e.jsxs(pr,{className:"grid w-full grid-cols-2",children:[e.jsx(Se,{value:"members",children:"Thành viên"}),e.jsx(Se,{value:"info",children:"Thông tin gia đình"})]}),e.jsxs(ke,{value:"members",className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-x-2 justify-end",children:[e.jsx(he,{I:"share",a:xe("FamilyMember",t),children:e.jsx(rs,{type:"family",familyId:t.id})}),e.jsx(he,{I:"create",a:xe("FamilyMember",t),children:e.jsxs(tt,{open:s,onOpenChange:a,children:[e.jsx(fn,{asChild:!0,children:e.jsxs(P,{children:[e.jsx(et,{className:"mr-2 h-4 w-4"}),"Thêm thành viên"]})}),e.jsx(Na,{family:t,onClose:()=>a(!1)})]})})]}),e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:(t.familyMembers||[]).map(h=>e.jsx(Ss,{member:h,isHouseholder:h.relationship==="Chủ hộ",isCurrentUserHouseholder:x===t.owner.id,onViewMedicalProfile:()=>i({to:`/home/families/${t.id}/members/${h.id}`})},h.id))})]}),e.jsx(ke,{value:"info",className:"space-y-6",children:e.jsx(Xs,{family:t})})]}),e.jsx(tt,{open:c,onOpenChange:o,children:e.jsx(jt,{className:"sm:max-w-[425px]",children:e.jsx(wa,{family:t,onSubmit:d,onCancel:()=>o(!1)})})})]})},wa=({family:t,onSubmit:n,onCancel:r})=>{const[s,a]=l.useState({name:t.name,address:t.address,phone:t.phone,email:t.email}),c=x=>{const{name:d,value:i}=x.target;a(h=>({...h,[d]:i}))},o=x=>{x.preventDefault(),n(s)};return e.jsxs(e.Fragment,{children:[e.jsxs(bt,{children:[e.jsx(yt,{children:"Cập nhật thông tin gia đình"}),e.jsx(Nt,{children:"Chỉnh sửa thông tin gia đình của bạn. Nhấn lưu khi hoàn tất."})]}),e.jsxs("form",{onSubmit:o,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"name",children:"Tên gọi gia đình"}),e.jsx(H,{id:"name",name:"name",placeholder:"Nhập tên gọi gia đình",value:s.name,onChange:c,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"address",children:"Địa chỉ"}),e.jsx(H,{id:"address",name:"address",placeholder:"Nhập địa chỉ",value:s.address,onChange:c,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"phone",children:"Số điện thoại liên hệ"}),e.jsx(H,{id:"phone",name:"phone",placeholder:"Nhập số điện thoại",value:s.phone,onChange:c,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"email",children:"Email liên hệ"}),e.jsx(H,{id:"email",name:"email",type:"email",placeholder:"Nhập địa chỉ email",value:s.email,onChange:c,required:!0})]}),e.jsxs(Ce,{className:"mt-6",children:[e.jsx(P,{type:"button",variant:"outline",onClick:r,children:"Hủy"}),e.jsx(P,{type:"submit",children:"Lưu thay đổi"})]})]})]})},ui=function(){const n=Zr({from:"/_layout/home/families/$familyId/"});return e.jsx(Ca,{family:n})};export{ui as component};
