import{r as o,j as e,u as G,t as B}from"./index-BW1v2Y3o.js";import{U as W}from"./UnAuthLayout-BsdPC7E-.js";import{a as V,u as K,F as _,s as q}from"./label-C5VtnZRZ.js";import{z as u}from"./index-B3p3PcZP.js";import{B as D}from"./index-lZj-UG3P.js";import{C as Q,a as X,b as Z,c as J,d as Y,e as ee}from"./card-Bb8dNGOw.js";import{I as w}from"./input-B9pFp4AM.js";import{a as g,b as y,c as C,d as b,e as k}from"./form-CBmUezT4.js";import{C as te}from"./checkbox-Do6_XIjt.js";import{T as se}from"./textarea-DMIEle1g.js";import{b as ne}from"./auth-controller-BpkYrUt_.js";import{M as ie,i as re,u as $,P as oe,a as ae,b as ce,L as le,m as z}from"./proxy-HQEJy3Ch.js";import{u as he}from"./useAuthRedirect-CmFNEkav.js";import"./index-Bvgfl4DN.js";import"./clsx-B-dksMZM.js";import"./index-BvPlwEJa.js";import"./check-BMh_iTMB.js";import"./createLucideIcon-BIXz2lW7.js";import"./index-Bb3g6j3I.js";class de extends o.Component{getSnapshotBeforeUpdate(n){const t=this.props.childRef.current;if(t&&n.isPresent&&!this.props.isPresent){const r=t.offsetParent,h=re(r)&&r.offsetWidth||0,c=this.props.sizeRef.current;c.height=t.offsetHeight||0,c.width=t.offsetWidth||0,c.top=t.offsetTop,c.left=t.offsetLeft,c.right=h-c.width-c.left}return null}componentDidUpdate(){}render(){return this.props.children}}function me({children:s,isPresent:n,anchorX:t}){const r=o.useId(),h=o.useRef(null),c=o.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:x}=o.useContext(ie);return o.useInsertionEffect(()=>{const{width:v,height:a,top:j,left:l,right:p}=c.current;if(n||!h.current||!v||!a)return;const i=t==="left"?`left: ${l}`:`right: ${p}`;h.current.dataset.motionPopId=r;const d=document.createElement("style");return x&&(d.nonce=x),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${v}px !important;
            height: ${a}px !important;
            ${i}px !important;
            top: ${j}px !important;
          }
        `),()=>{document.head.contains(d)&&document.head.removeChild(d)}},[n]),e.jsx(de,{isPresent:n,childRef:h,sizeRef:c,children:o.cloneElement(s,{ref:h})})}const ue=({children:s,initial:n,isPresent:t,onExitComplete:r,custom:h,presenceAffectsLayout:c,mode:x,anchorX:v})=>{const a=$(pe),j=o.useId();let l=!0,p=o.useMemo(()=>(l=!1,{id:j,initial:n,isPresent:t,custom:h,onExitComplete:i=>{a.set(i,!0);for(const d of a.values())if(!d)return;r&&r()},register:i=>(a.set(i,!1),()=>a.delete(i))}),[t,a,r]);return c&&l&&(p={...p}),o.useMemo(()=>{a.forEach((i,d)=>a.set(d,!1))},[t]),o.useEffect(()=>{!t&&!a.size&&r&&r()},[t]),x==="popLayout"&&(s=e.jsx(me,{isPresent:t,anchorX:v,children:s})),e.jsx(oe.Provider,{value:p,children:s})};function pe(){return new Map}const R=s=>s.key||"";function L(s){const n=[];return o.Children.forEach(s,t=>{o.isValidElement(t)&&n.push(t)}),n}const xe=({children:s,custom:n,initial:t=!0,onExitComplete:r,presenceAffectsLayout:h=!0,mode:c="sync",propagate:x=!1,anchorX:v="left"})=>{const[a,j]=ae(x),l=o.useMemo(()=>L(s),[s]),p=x&&!a?[]:l.map(R),i=o.useRef(!0),d=o.useRef(l),S=$(()=>new Map),[U,A]=o.useState(l),[N,T]=o.useState(l);ce(()=>{i.current=!1,d.current=l;for(let f=0;f<N.length;f++){const m=R(N[f]);p.includes(m)?S.delete(m):S.get(m)!==!0&&S.set(m,!1)}},[N,p.length,p.join("-")]);const E=[];if(l!==U){let f=[...l];for(let m=0;m<N.length;m++){const F=N[m],P=R(F);p.includes(P)||(f.splice(m,0,F),E.push(F))}return c==="wait"&&E.length&&(f=E),T(L(f)),A(l),null}const{forceRender:M}=o.useContext(le);return e.jsx(e.Fragment,{children:N.map(f=>{const m=R(f),F=x&&!a?!1:l===N||p.includes(m),P=()=>{if(S.has(m))S.set(m,!0);else return;let I=!0;S.forEach(H=>{H||(I=!1)}),I&&(M==null||M(),T(d.current),x&&(j==null||j()),r&&r())};return e.jsx(ue,{isPresent:F,initial:!i.current||t?void 0:!1,custom:n,presenceAffectsLayout:h,mode:c,onExitComplete:F?void 0:P,anchorX:v,children:f},m)})})},O=u.object({password:u.string().min(8,"Mật khẩu phải có ít nhất 8 ký tự").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Mật khẩu phải chứa ít nhất 1 chữ hoa, 1 chữ thường và 1 số"),email:u.string().email("Email không hợp lệ"),fullName:u.string().min(2,"Họ tên phải có ít nhất 2 ký tự"),dateOfBirth:u.date({required_error:"Vui lòng chọn ngày sinh"}),isDoctor:u.boolean().default(!1)}),fe=u.object({specialty:u.string().min(2,"Vui lòng nhập chuyên khoa"),licenseNumber:u.string().min(5,"Số giấy phép không hợp lệ"),medicalFacility:u.string().min(2,"Vui lòng nhập cơ sở y tế"),bio:u.string().min(10,"Giới thiệu phải có ít nhất 10 ký tự")}),je=u.discriminatedUnion("isDoctor",[O.extend({isDoctor:u.literal(!1)}),O.extend({isDoctor:u.literal(!0)}).merge(fe)]);function ge(){const{control:s,formState:{errors:n}}=V();return e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{control:s,name:"fullName",render:({field:t})=>e.jsxs(y,{children:[e.jsx(C,{children:"Họ và tên"}),e.jsx(b,{children:e.jsx(w,{placeholder:"Nhập họ tên đầy đủ",...t})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"email",render:({field:t})=>e.jsxs(y,{children:[e.jsx(C,{children:"Email"}),e.jsx(b,{children:e.jsx(w,{type:"email",placeholder:"example@example.com",...t})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"password",render:({field:t})=>e.jsxs(y,{children:[e.jsx(C,{children:"Mật khẩu"}),e.jsx(b,{children:e.jsx(w,{type:"password",placeholder:"********",...t})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"dateOfBirth",render:({field:t})=>e.jsxs(y,{className:"flex flex-col",children:[e.jsx(C,{children:"Ngày sinh"}),e.jsx(b,{children:e.jsx(w,{type:"date",max:new Date().toISOString().split("T")[0],min:"1900-01-01",value:t.value?new Date(t.value).toISOString().split("T")[0]:"",onChange:r=>{const h=r.target.value;t.onChange(h?new Date(h):void 0)}})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"isDoctor",render:({field:t})=>e.jsxs(y,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(b,{children:e.jsx(te,{checked:t.value,onCheckedChange:t.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(C,{children:"Tôi là bác sĩ"})})]})})]})}function ye(){const{control:s}=V();return e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{control:s,name:"specialty",render:({field:n})=>e.jsxs(y,{children:[e.jsx(C,{children:"Chuyên khoa"}),e.jsx(b,{children:e.jsx(w,{placeholder:"Ví dụ: Nội khoa, Tim mạch,...",...n})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"licenseNumber",render:({field:n})=>e.jsxs(y,{children:[e.jsx(C,{children:"Số giấy phép hành nghề"}),e.jsx(b,{children:e.jsx(w,{placeholder:"Nhập số giấy phép",...n})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"medicalFacility",render:({field:n})=>e.jsxs(y,{children:[e.jsx(C,{children:"Cơ sở y tế"}),e.jsx(b,{children:e.jsx(w,{placeholder:"Tên bệnh viện/phòng khám",...n})}),e.jsx(k,{})]})}),e.jsx(g,{control:s,name:"bio",render:({field:n})=>e.jsxs(y,{children:[e.jsx(C,{children:"Giới thiệu"}),e.jsx(b,{children:e.jsx(se,{placeholder:"Giới thiệu về kinh nghiệm và chuyên môn của bạn",className:"resize-none min-h-[100px]",...n})}),e.jsx(k,{})]})})]})}function Ce(){const[s,n]=o.useState(0),t=G(),r=K({resolver:q(je),defaultValues:{password:"",email:"",fullName:"",isDoctor:!1},mode:"onChange"}),{handleSubmit:h,watch:c}=r,x=c("isDoctor"),{mutateAsync:v,isPending:a}=ne(),j=i=>{console.log("Form submitted:",i),v({data:{dateOfBirth:i.dateOfBirth.toISOString(),email:i.email,fullName:i.fullName,password:i.password,doctor:x?{bio:i.bio,licenseNumber:i.licenseNumber,medicalFacility:i.medicalFacility,specialty:i.specialty}:void 0}}).then(()=>{setTimeout(()=>{t({to:"/login"})},5e3),B.success("Đăng ký tài khoản thành công",{duration:5e3,description:"Đăng nhập để trải nghiệm ứng dụng"})}).catch(d=>{B.error("Đăng ký tài khoản thất bại",{duration:5e3,description:d.message})})},l=async()=>{await r.trigger(["password","email","fullName","dateOfBirth","isDoctor"])&&n(1)},p=()=>{n(0)};return e.jsx("div",{className:"flex items-center justify-center min-h-[80vh] bg-background p-4",children:e.jsxs(Q,{className:"w-full max-w-md shadow-lg",children:[e.jsxs(X,{className:"space-y-1",children:[e.jsx(Z,{className:"text-2xl font-bold text-center",children:"Đăng ký tài khoản"}),e.jsx(J,{className:"text-center",children:s===0?"Nhập thông tin tài khoản của bạn":"Thông tin bác sĩ"})]}),e.jsx(_,{...r,children:e.jsxs("form",{onSubmit:h(j),children:[e.jsx(Y,{className:"space-y-4",children:e.jsx(xe,{mode:"wait",children:s===0?e.jsx(z.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:e.jsx(ge,{})},"step-1"):e.jsx(z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:e.jsx(ye,{})},"step-2")})}),e.jsx(ee,{className:"flex justify-between",children:s===1?e.jsxs("div",{className:"pt-2 flex justify-between w-full",children:[e.jsx(D,{type:"button",variant:"outline",disabled:a,onClick:p,children:"Quay lại"}),e.jsx(D,{disabled:a,type:"submit",children:"Đăng ký"})]}):e.jsx("div",{className:"pt-2 flex justify-end w-full",children:x?e.jsx(D,{type:"button",onClick:l,disabled:a,children:"Tiếp theo"}):e.jsx(D,{disabled:a,type:"submit",children:"Đăng ký"})})})]})})]})})}function be(){return he(),e.jsx(W,{children:e.jsx(Ce,{})})}const Ue=function(){return e.jsx(be,{})};export{Ue as component};
