import{u as b,a as y,r as l,t as o,R as C,j as s}from"./index-BW1v2Y3o.js";import{U as N}from"./UnAuthLayout-BsdPC7E-.js";import{u as P,s as F}from"./label-C5VtnZRZ.js";import{z as c}from"./index-B3p3PcZP.js";import{B as S}from"./index-lZj-UG3P.js";import{C as R,a as v,b as M,c as E,d as m,e as T}from"./card-Bb8dNGOw.js";import{I as d}from"./input-B9pFp4AM.js";import{F as B,a as u,b as p,c as x,d as g,e as f}from"./form-CBmUezT4.js";import{u as V,a as I}from"./auth-controller-BpkYrUt_.js";import"./index-Bvgfl4DN.js";import"./clsx-B-dksMZM.js";const L=/^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=]).*$/,q=c.object({password:c.string().min(8,{message:"Mật khẩu phải có ít nhất 8 ký tự"}).max(100,{message:"Mật khẩu không được vượt quá 100 ký tự"}).regex(L,{message:"Mật khẩu phải chứa ít nhất 1 chữ thường, 1 chữ hoa, 1 số và 1 ký tự đặc biệt"}),confirmPassword:c.string()}).refine(e=>e.password===e.confirmPassword,{message:"Mật khẩu không khớp",path:["confirmPassword"]});function z(){const e=b(),j=y({strict:!1}),[i,k]=l.useState(!1),t=j.token;l.useEffect(()=>{t||(o.error("Liên kết đặt lại mật khẩu không hợp lệ",{duration:3e3}),e({to:"/forgot-password"}))},[t,e]);const n=P({resolver:F(q),defaultValues:{password:"",confirmPassword:""},mode:"onChange"}),{isError:h}=V({token:t},{query:{enabled:!!t}});C.useEffect(()=>{h&&(o.error("Token không hợp lệ hoặc đã hết hạn",{duration:5e3,description:"Vui lòng thử lại."}),e({to:"/forgot-password"}))},[h,e]);const a=I({mutation:{onSuccess:()=>{k(!0),o.success("Đặt lại mật khẩu thành công",{duration:5e3,description:"Bạn sẽ được chuyển hướng đến trang đăng nhập."}),setTimeout(()=>{e({to:"/login"})},3e3)},onError:r=>{console.error("Error resetting password:",r),o.error("Đặt lại mật khẩu thất bại",{duration:5e3,description:"Token đã hết hạn hoặc không hợp lệ. Vui lòng thử lại."})}}}),w=async r=>{t&&a.mutate({data:{token:t,password:r.password}})};return t?s.jsx("div",{className:"flex items-center justify-center min-h-[80vh] bg-background p-4",children:s.jsxs(R,{className:"w-full max-w-md shadow-lg",children:[s.jsxs(v,{className:"space-y-1",children:[s.jsx(M,{className:"text-2xl font-bold text-center",children:"Đặt lại mật khẩu"}),s.jsx(E,{className:"text-center",children:i?"Mật khẩu đã được đặt lại thành công":"Nhập mật khẩu mới của bạn"})]}),i?s.jsxs(m,{className:"space-y-4 text-center",children:[s.jsx("p",{children:"Mật khẩu của bạn đã được đặt lại thành công."}),s.jsx("p",{children:"Bạn sẽ được chuyển hướng đến trang đăng nhập trong vài giây."})]}):s.jsx(B,{...n,children:s.jsxs("form",{onSubmit:n.handleSubmit(w),children:[s.jsxs(m,{className:"space-y-4",children:[s.jsx(u,{control:n.control,name:"password",render:({field:r})=>s.jsxs(p,{children:[s.jsx(x,{children:"Mật khẩu mới"}),s.jsx(g,{children:s.jsx(d,{placeholder:"••••••••",type:"password",...r})}),s.jsx(f,{})]})}),s.jsx(u,{control:n.control,name:"confirmPassword",render:({field:r})=>s.jsxs(p,{children:[s.jsx(x,{children:"Xác nhận mật khẩu"}),s.jsx(g,{children:s.jsx(d,{placeholder:"••••••••",type:"password",...r})}),s.jsx(f,{})]})})]}),s.jsx(T,{className:"flex flex-col space-y-4 pt-3",children:s.jsx(S,{type:"submit",className:"w-full",disabled:a.isPending,children:a.isPending?"Đang xử lý...":"Đặt lại mật khẩu"})})]})})]})}):null}const Q=function(){return s.jsx(N,{children:s.jsx(z,{})})};export{Q as component};
