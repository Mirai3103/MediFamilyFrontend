import{c as x}from"./createLucideIcon-BIXz2lW7.js";import{j as e,o as F,Y as S,R as q,s as f,Z as D,t as v,_ as T}from"./index-BW1v2Y3o.js";import{B as j,c as _}from"./index-lZj-UG3P.js";import{I as p}from"./input-B9pFp4AM.js";import{z as a}from"./index-B3p3PcZP.js";import{u as P,s as R}from"./label-C5VtnZRZ.js";import{g as B,f as z}from"./drawer-CY_oHpP7.js";import{F as H,a as l,b as o,c,d as h,e as d,f as $}from"./form-CBmUezT4.js";import{P as A,a as L,b as G,C as I}from"./popover-DmVzagL2.js";import{C as y}from"./calendar-DSwk2Pit.js";import{f as K}from"./format-CR5l4UVX.js";import{v as N}from"./vi-vOVGMeUr.js";import{T as V}from"./textarea-DMIEle1g.js";import{C as E}from"./checkbox-Do6_XIjt.js";import{U as Q}from"./user-BXjafA9g.js";import{S as O}from"./stethoscope-BzvBMdBi.js";import{P as U}from"./plus-Brih1OWA.js";/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],Y=x("Building",Z);/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],W=x("CalendarCheck",J);/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ce=x("CircleAlert",X);/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],se=x("ClipboardList",ee);/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 13v-1h6v1",key:"1bb014"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"M11 18h2",key:"12mj7e"}]],ae=x("FileType",te);/**
 * @license lucide-react v0.481.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M17 12h-2l-2 5-2-10-2 5H7",key:"15hlnc"}]],ne=x("SquareActivity",re);function b({date:r,onSelect:u,disabled:g}){return e.jsxs(A,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:_("w-full justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),r?K(r,"PPP",{locale:N}):e.jsx("span",{children:"Chọn ngày"})]})}),e.jsx(G,{className:"w-auto p-0",align:"start",children:e.jsx(I,{mode:"single",selected:r,onSelect:n=>n&&u(n),disabled:g,locale:N,initialFocus:!0})})]})}const ie=a.object({id:a.number().optional(),title:a.string().min(1,{message:"Tiêu đề không được để trống"}),visitDate:a.date({required_error:"Vui lòng chọn ngày khám"}).refine(r=>r<=new Date,{message:"Ngày khám phải là ngày hiện tại hoặc trong quá khứ"}),medicalFacility:a.string().min(2,{message:"Tên cơ sở y tế phải có ít nhất 2 ký tự"}).max(200,{message:"Tên cơ sở y tế không được vượt quá 200 ký tự"}),doctorName:a.string().min(2,{message:"Tên bác sĩ phải có ít nhất 2 ký tự"}).max(100,{message:"Tên bác sĩ không được vượt quá 100 ký tự"}).optional(),diagnosis:a.string().min(2,{message:"Chẩn đoán phải có ít nhất 2 ký tự"}).max(500,{message:"Chẩn đoán không được vượt quá 500 ký tự"}),treatment:a.string().max(1e3,{message:"Phương pháp điều trị không được vượt quá 1000 ký tự"}).optional(),notes:a.string().max(2e3,{message:"Ghi chú không được vượt quá 2000 ký tự"}).optional(),isFollowup:a.boolean().default(!1),followupDate:a.date().refine(r=>r>new Date,{message:"Ngày tái khám phải là ngày trong tương lai"}).optional()});function Me({type:r,recordId:u,profileId:g,onDone:n}){const t=P({resolver:R(ie),defaultValues:{title:"",visitDate:new Date,medicalFacility:"",doctorName:"",diagnosis:"",treatment:"",notes:"",isFollowup:!1}}),w=F(),{data:m}=S(u,{query:{enabled:r==="edit"&&!!u}});q.useEffect(()=>{if(console.log("data",m),!m)return m;console.log("reseting form",m),t.reset({...m,visitDate:f(m.visitDate).toDate(),followupDate:f(m.followupDate).toDate()})},[m,t]);const{mutate:C,mutateAsync:le}=D({mutation:{onSuccess:s=>{t.reset(),v("Thêm hồ sơ thành công",{description:"Hồ sơ khám đã được thêm vào hệ thống"}),w.invalidateQueries({queryKey:T(g)}),n==null||n(!0)},onError:s=>{var i,k;v("Lỗi",{description:((k=(i=s.response)==null?void 0:i.data)==null?void 0:k.message)||s.message}),n==null||n(!1)}}}),M=async s=>{var i;C({data:{...s,visitDate:s.visitDate.toISOString(),followupDate:s.isFollowup?(i=s.followupDate)==null?void 0:i.toISOString():void 0,profileId:g}})};return e.jsx(H,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(M),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:t.control,name:"title",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 h-4 w-4 text-health-blue"}),"Tiêu đề"]}),e.jsx(h,{children:e.jsx(p,{placeholder:"Khám tổng quát, Khám chuyên khoa...",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:t.control,name:"visitDate",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(y,{className:"mr-2 h-4 w-4 text-health-blue"}),"Ngày khám"]}),e.jsx(h,{children:e.jsx(b,{date:s.value,onSelect:s.onChange,disabled:i=>i>new Date})}),e.jsx(d,{})]})}),e.jsx(l,{control:t.control,name:"medicalFacility",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(Y,{className:"mr-2 h-4 w-4 text-health-blue"}),"Cơ sở y tế"]}),e.jsx(h,{children:e.jsx(p,{placeholder:"Bệnh viện, phòng khám...",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:t.control,name:"doctorName",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(Q,{className:"mr-2 h-4 w-4 text-health-blue"}),"Bác sĩ"]}),e.jsx(h,{children:e.jsx(p,{placeholder:"Tên bác sĩ",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:t.control,name:"diagnosis",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(O,{className:"mr-2 h-4 w-4 text-health-blue"}),"Chẩn đoán"]}),e.jsx(h,{children:e.jsx(p,{placeholder:"Chẩn đoán của bác sĩ",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:t.control,name:"treatment",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(se,{className:"mr-2 h-4 w-4 text-health-blue"}),"Phương pháp điều trị"]}),e.jsx(h,{children:e.jsx(p,{placeholder:"Phương pháp điều trị",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:t.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-4 w-4 text-health-blue"}),"Ghi chú"]}),e.jsx(h,{children:e.jsx(V,{placeholder:"Những ghi chú về tình trạng sức khỏe, kết quả khám...",className:"resize-none h-24",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:t.control,name:"isFollowup",render:({field:s})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(h,{children:e.jsx(E,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(W,{className:"mr-2 h-4 w-4 text-health-blue"}),"Hẹn tái khám"]}),e.jsx($,{children:"Đánh dấu nếu bác sĩ có hẹn tái khám"})]})]})}),t.watch("isFollowup")&&e.jsx(l,{control:t.control,name:"followupDate",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(c,{className:"flex items-center",children:[e.jsx(y,{className:"mr-2 h-4 w-4 text-health-blue"}),"Ngày tái khám"]}),e.jsx(h,{children:e.jsx(b,{date:s.value,onSelect:s.onChange,disabled:i=>i<new Date})}),e.jsx(d,{})]})}),e.jsx(B,{className:"px-0",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(z,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",children:"Hủy"})}),e.jsx(j,{type:"submit",className:"",disabled:t.formState.isSubmitting,children:t.formState.isSubmitting?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-xs mr-2"}),"Đang lưu..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Thêm hồ sơ"]})})]})})]})})}export{Y as B,Ce as C,b as D,Me as R};
