import{f as ae,e as ne,c as Q,d as z,u as W,b as O,r as L,R as $,j as e,L as g,g as re,h as ie,O as ce}from"./index-BW1v2Y3o.js";import{F as oe,a as le,b as me,c as F,d as de,e as ue,f as he,g as fe,h as S,i as xe,j as je,k as pe,l as ge,m as Ne,n as be}from"./index-Bvgfl4DN.js";import{c as k,B as N}from"./index-lZj-UG3P.js";import{A as T,a as q,b as I}from"./avatar-CiTwwk9L.js";import{D as H,a as G,b as _,c as K,d as ye}from"./dropdown-menu-B6SE2GuO.js";import{S as we,a as Me,b as ve}from"./sheet-BqcafAUO.js";import{B as De}from"./badge-B4P0SrPl.js";import{t as D,c as Ae,n as J,g as B,a as Fe,e as ke,m as P,b as C}from"./en-US-5imNvEBo.js";import{e as Ce,d as Oe}from"./endOfMonth-DGAv_To5.js";import{e as Re}from"./endOfDay-D2_vhOVw.js";import{v as Se}from"./vi-vOVGMeUr.js";import{m as Y}from"./proxy-HQEJy3Ch.js";import{L as Te}from"./loader-circle-hO0Wh3rx.js";import"./clsx-B-dksMZM.js";import"./index-BvPlwEJa.js";import"./index-BYx5ngvf.js";import"./file-D5Y2yJfI.js";import"./index-DcUGr25C.js";import"./index-fdDP8kav.js";import"./createLucideIcon-BIXz2lW7.js";import"./index-BWVphily.js";import"./index-Bb3g6j3I.js";import"./index-CqIhzmhs.js";function qe(t){return ae({select:n=>n.location})}function Ie({className:t}){return null}const Ke=(t,n)=>z({url:`/api/notifications/read/${t}`,method:"PATCH"},n),Le=t=>{const n=["markAsRead"],{mutation:a,request:s}=t?t.mutation&&"mutationKey"in t.mutation&&t.mutation.mutationKey?t:{...t,mutation:{...t.mutation,mutationKey:n}}:{mutation:{mutationKey:n},request:void 0};return{mutationFn:m=>{const{id:o}=m??{};return Ke(o,s)},...a}},ze=(t,n)=>{const a=Le(t);return Q(a)},Xe=t=>z({url:"/api/notifications/read-all",method:"PATCH"},t),Ue=t=>{const n=["markAllAsRead"],{mutation:a,request:s}=t?t.mutation&&"mutationKey"in t.mutation&&t.mutation.mutationKey?t:{...t,mutation:{...t.mutation,mutationKey:n}}:{mutation:{mutationKey:n},request:void 0};return{mutationFn:()=>Xe(s),...a}},Ee=(t,n)=>{const a=Ue(t);return Q(a)},He=(t,n,a)=>z({url:"/api/notifications/my-notifications",method:"GET",params:t,signal:a},n),Ge=t=>["/api/notifications/my-notifications",...t?[t]:[]],_e=(t,n)=>{const{query:a,request:s}={};return{queryKey:(a==null?void 0:a.queryKey)??Ge(t),queryFn:({signal:o})=>He(t,s,o),...a}};function Be(t,n,a){const s=_e(t),r=ne(s);return r.queryKey=s.queryKey,r}function R(t,n){const a=+D(t)-+D(n);return a<0?-1:a>0?1:a}function Pe(t){return Ae(t,Date.now())}function Ye(t){return n=>{const s=(t?Math[t]:Math.trunc)(n);return s===0?0:s}}function Qe(t,n){return+D(t)-+D(n)}function We(t,n){const a=D(t,n==null?void 0:n.in);return+Re(a,n)==+Ce(a,n)}function $e(t,n,a){const[s,r,m]=J(a==null?void 0:a.in,t,t,n),o=R(r,m),i=Math.abs(Oe(r,m));if(i<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*i);let u=R(r,m)===-o;We(s)&&i===1&&R(s,m)===1&&(u=!1);const f=o*(i-+u);return f===0?0:f}function Je(t,n,a){const s=Qe(t,n)/1e3;return Ye(a==null?void 0:a.roundingMethod)(s)}function Ve(t,n,a){const s=Fe(),r=(a==null?void 0:a.locale)??s.locale??ke,m=2520,o=R(t,n);if(isNaN(o))throw new RangeError("Invalid time value");const i=Object.assign({},a,{addSuffix:a==null?void 0:a.addSuffix,comparison:o}),[u,f]=J(a==null?void 0:a.in,...o>0?[n,t]:[t,n]),x=Je(f,u),A=(B(f)-B(u))/1e3,l=Math.round((x-A)/60);let h;if(l<2)return a!=null&&a.includeSeconds?x<5?r.formatDistance("lessThanXSeconds",5,i):x<10?r.formatDistance("lessThanXSeconds",10,i):x<20?r.formatDistance("lessThanXSeconds",20,i):x<40?r.formatDistance("halfAMinute",0,i):x<60?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",1,i):l===0?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",l,i);if(l<45)return r.formatDistance("xMinutes",l,i);if(l<90)return r.formatDistance("aboutXHours",1,i);if(l<P){const j=Math.round(l/60);return r.formatDistance("aboutXHours",j,i)}else{if(l<m)return r.formatDistance("xDays",1,i);if(l<C){const j=Math.round(l/P);return r.formatDistance("xDays",j,i)}else if(l<C*2)return h=Math.round(l/C),r.formatDistance("aboutXMonths",h,i)}if(h=$e(f,u),h<12){const j=Math.round(l/C);return r.formatDistance("xMonths",j,i)}else{const j=h%12,b=Math.trunc(h/12);return j<3?r.formatDistance("aboutXYears",b,i):j<9?r.formatDistance("overXYears",b,i):r.formatDistance("almostXYears",b+1,i)}}function Ze(t,n){return Ve(t,Pe(t),n)}const et=({children:t})=>{const n=qe(),a=W(),s=O(c=>c.profile),r=O(c=>c.logout),[m,o]=L.useState(!1),i=O(c=>c.ability),u=$.useMemo(()=>[{path:"/home",label:"Tổng quan",icon:e.jsx(oe,{className:"mr-3 h-4 w-4"})},{path:"/home/families",label:"Gia đình",icon:e.jsx(le,{className:"mr-3 h-4 w-4"})},{path:"/home/manage-family",label:"Gia đình được quản lý",icon:e.jsx(me,{className:"mr-3 h-4 w-4"}),isRender:i==null?void 0:i.can("manage","Household")},{path:"/home/health-profile",label:"Hồ sơ y tế",icon:e.jsx(F,{className:"mr-3 h-4 w-4"})},{path:"/home/vaccination",label:"Tiêm ngừa",icon:e.jsx(de,{className:"mr-3 h-4 w-4"})},{path:"/home/documents",label:"Tài liệu",icon:e.jsx(ue,{className:"mr-3 h-4 w-4"})},{path:"/home/reminders",label:"Nhắc nhở",icon:e.jsx(he,{className:"mr-3 h-4 w-4"})},{path:"/home/share/family",label:"Gia đình được chia sẻ",icon:e.jsx(fe,{className:"mr-3 h-4 w-4"})}].filter(c=>c.isRender!==!1),[i]),f=async()=>{await r(),a({to:"/login"})},{data:x,refetch:A}=Be({pageable:{page:0,size:30,sort:["createdAt,desc"]}}),l=(x==null?void 0:x.content)||[],h=l.filter(c=>!c.isRead).length,j=ze({mutation:{onSuccess:()=>{A()}}}),b=Ee({mutation:{onSuccess:()=>{A()}}}),V=c=>{j.mutate({id:c.toString()})},Z=()=>{b.mutate()},ee=c=>{if(!c)return"";try{return Ze(new Date(c),{addSuffix:!0,locale:Se})}catch{return c}},te=()=>{var c,y,w,M,v,p,X,U,E;return e.jsxs("header",{className:"sticky top-0 z-40 h-16 flex items-center justify-between px-4 border-b bg-background border-border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(we,{open:m,onOpenChange:o,children:[e.jsx(Me,{asChild:!0,className:"lg:hidden",children:e.jsx(N,{variant:"ghost",size:"icon",className:"mr-2 lg:hidden",children:e.jsx(xe,{className:"h-5 w-5"})})}),e.jsxs(ve,{side:"left",className:"w-72 p-0 lg:hidden",children:[e.jsxs(g,{className:"h-16 flex items-center px-6 border-b border-border",to:"/",children:[e.jsx(F,{className:"h-6 w-6 text-primary mr-2"}),e.jsx("span",{className:"text-xl font-bold",children:"MedFamily"}),e.jsx(N,{variant:"ghost",size:"icon",className:"ml-auto",onClick:()=>o(!1),children:e.jsx(je,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(T,{className:"h-10 w-10",children:[e.jsx(q,{src:((c=s==null?void 0:s.profile)==null?void 0:c.avatarUrl)||"https://placewaifu.com/image/300/300",alt:(y=s==null?void 0:s.profile)==null?void 0:y.fullName}),e.jsx(I,{children:((M=(w=s==null?void 0:s.profile)==null?void 0:w.fullName)==null?void 0:M.charAt(0))||"U"})]}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:(v=s==null?void 0:s.profile)==null?void 0:v.fullName}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s==null?void 0:s.email})]})]})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-4 px-4",children:e.jsx("ul",{className:"space-y-2",children:u.map(d=>e.jsx("li",{children:e.jsxs(g,{to:d.path,onClick:()=>o(!1),className:k("flex items-center px-4 py-3 text-sm font-medium rounded-md transition-colors",n.pathname.startsWith(d.path)?"bg-accent text-accent-foreground":"text-foreground hover:bg-accent/50 hover:text-accent-foreground"),children:[d.icon,d.label]})},d.path))})}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsxs(N,{variant:"outline",className:"w-full flex items-center justify-center",onClick:f,children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Đăng xuất"]})})]})]}),e.jsxs(g,{to:"/",className:"flex items-center",children:[e.jsx(F,{className:"h-6 w-6 text-primary mr-2"}),e.jsx("span",{className:"text-xl font-bold lg:hidden",children:"MedFamily"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs(H,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(N,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(pe,{className:"h-5 w-5"}),h>0&&e.jsx(De,{className:"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center rounded-full bg-primary text-primary-foreground text-xs",children:h>99?"99+":h})]})}),e.jsxs(_,{align:"end",className:"w-80",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[e.jsx("span",{className:"font-medium",children:"Thông báo"}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:Z,disabled:h===0||b.isPending,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Đánh dấu đã đọc"]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:l.length===0?e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:"Không có thông báo nào"}):l.map(d=>e.jsxs("div",{className:k("py-2 px-4 border-b hover:bg-accent/20 cursor-pointer",!d.isRead&&"bg-accent/10"),onClick:()=>{d.isRead||V(d.id)},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-sm font-medium",children:d.title}),!d.isRead&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary mt-1 ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:d.content}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:ee(d.createdAt)})]},d.id))})]})]}),e.jsx(Ie,{className:"ml-2"}),e.jsxs(H,{children:[e.jsx(G,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"ml-2",children:e.jsxs(T,{className:"h-8 w-8",children:[e.jsx(q,{src:((p=s==null?void 0:s.profile)==null?void 0:p.avatarUrl)||"https://placewaifu.com/image/300/300",alt:(X=s==null?void 0:s.profile)==null?void 0:X.fullName}),e.jsx(I,{children:((E=(U=s==null?void 0:s.profile)==null?void 0:U.fullName)==null?void 0:E.charAt(0))||"U"})]})})}),e.jsxs(_,{align:"end",children:[e.jsx(g,{to:"/home/user-profile",children:e.jsxs(K,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Hồ sơ"]})}),e.jsx(g,{to:"/home/user-profile",children:e.jsxs(K,{children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Cài đặt"]})}),e.jsx(ye,{}),e.jsxs(K,{onClick:f,children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Đăng xuất"]})]})]})]})]})},se=()=>{var c,y,w,M,v;return e.jsxs("div",{className:"hidden lg:flex h-screen w-64 flex-col fixed left-0 top-0 bottom-0 bg-sidebar border-r border-sidebar-border",children:[e.jsxs(g,{className:"h-16 flex items-center px-6 border-b border-sidebar-border",to:"/",children:[e.jsx(F,{className:"h-6 w-6 text-primary mr-2"}),e.jsx("span",{className:"text-xl font-bold",children:"MedFamily"})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-4 px-4",children:e.jsx("ul",{className:"space-y-2",children:u.map(p=>e.jsx("li",{children:e.jsxs(g,{to:p.path,className:k("flex items-center px-4 py-2.5 text-sm font-medium rounded-md transition-colors",n.pathname.startsWith(p.path)?"bg-sidebar-accent text-sidebar-accent-foreground":"text-sidebar-foreground hover:bg-sidebar-accent/50 hover:text-sidebar-accent-foreground"),children:[p.icon,p.label]})},p.path))})}),e.jsx("div",{className:"p-4 border-t border-sidebar-border",children:e.jsxs(g,{className:"flex items-center",to:"/home/user-profile",children:[e.jsxs(T,{className:"h-9 w-9",children:[e.jsx(q,{src:((c=s==null?void 0:s.profile)==null?void 0:c.avatarUrl)||"https://placewaifu.com/image/300/300",alt:(y=s==null?void 0:s.profile)==null?void 0:y.fullName}),e.jsx(I,{children:((M=(w=s==null?void 0:s.profile)==null?void 0:w.fullName)==null?void 0:M.charAt(0))||"U"})]}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:(v=s==null?void 0:s.profile)==null?void 0:v.fullName}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s==null?void 0:s.email})]}),e.jsx(N,{variant:"ghost",size:"icon",onClick:f,children:e.jsx(S,{className:"h-5 w-5"})})]})})]})};return e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsxs("div",{className:k("min-h-screen bg-background","lg:pl-64"),children:[e.jsx(te,{}),e.jsx("main",{className:"p-4 md:p-6 max-w-7xl mx-auto",children:t})]})]})},vt=function(){const{isAuthenticated:n,isLoading:a,fetchUserProfile:s,mergeAbility:r,profile:m}=O(),o=W();L.useEffect(()=>{s()},[s]),L.useEffect(()=>{!a&&!n&&o({to:"/login?redirectTo="+window.location.pathname})},[a,n,o]);const{data:i}=re({page:0,size:1e3,sort:["createdAt,desc"],status:"ACCEPTED"},{query:{enabled:(m==null?void 0:m.role)=="ROLE_DOCTOR"}});return $.useEffect(()=>{i&&i.content&&m&&setTimeout(()=>{r(ie(i.content.map(u=>u.familyId)))},1e3)},[i,m]),a?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs(Y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"flex flex-col items-center space-y-4",children:[e.jsx(Y.div,{animate:{rotate:360},transition:{duration:1.5,repeat:1/0,ease:"linear"},children:e.jsx(Te,{className:"w-12 h-12 text-primary"})}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Đang tải dữ liệu..."})]})}):e.jsx(et,{children:e.jsx(ce,{})})};export{vt as component};
